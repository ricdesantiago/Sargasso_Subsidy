---
title: "Sargasso_Subisidy_Code"
output: html_document
---

#libraries
```{r}
library(knitr)
library(tidyverse)
library(tidyr)
library(ggplot2)
library(ggfortify)
library(lme4)
library(car)
library(nlme)
library(ggpubr)
library(multcompView)
library(boot)
library(Hotelling)
library(mvnTest)
library(vegan)
library(factoextra)
library(FactoMineR)
library(agricolae)
library(glmm)
library(HH)
library(ggpubr)
library(rstatix)
library(vegan)
```
#Plant Communities
## Pile metrics
```{r}
piles <-read.csv("Sargassum_piles.csv",header=T)
piles2<-subset(piles, Treatment== "Sargassum")

# Create the scatter plot with jittered points and add a trendline
ggplot(piles2, aes(x = Month, y = Cone_Vol, color = Location)) +
  geom_boxplot() +
  geom_smooth(method = "lm", se = FALSE)
  

# Calculate the means by month and location
mean_data <- piles2 %>%
  group_by(Month, Location) %>%
  summarize(mean_cone_vol = mean(Cone_Vol))

# Create the scatter plot with mean points connected by a line
scatterplot <- ggplot(data = piles2, aes(x = Month, y = Cone_Vol, color = Location)) +
  geom_point(size = 2, shape = 21, aes(fill = Location)) +
  geom_line(data = mean_data, aes(x = Month, y = mean_cone_vol, group = Location), color = "gray")

# Customize the plot appearance
scatterplot + 
  labs(x = "Month", y = "Pile Volume") +
  scale_color_manual(values = c("orange2", "darkgreen")) +
  scale_fill_manual(values = c("orange2", "darkgreen")) +
  theme_minimal()


```


## Interior survey
```{r}
#upload and subset data for interior surveys 
#import dataset
plants<-read.csv("plantcommunity.csv", header = TRUE)
View(plants)

#subset out only the "random" and "interior"  since those are comparable (3 quads each pile interior)
noladder<-subset(plants, !Survey == "Ladder" )
interiorsurvey<-subset(noladder, !Survey == "HiLo")
view(interiorsurvey)
is.factor(interiorsurvey$Treatment)
interiorsurvey$Treatment<-as.factor(interiorsurvey$Treatment)


```

###nMDS Plot
```{r}
#compare communities differences using NMDS
#use only the data we are interested in
##plants first
nm <- (interiorsurvey[,c(8:60)])
View(nm)
#make matrix
matrix = as.matrix(nm)
view(matrix)
nmds_result = metaMDS(matrix, distance = "bray")
plot(nmds_result)
nmds_result

# Create a new data frame with NMDS coordinates, grouping, and additional descriptor information
nmds_data <- data.frame(nmds_result$points, Site = interiorsurvey$Site, Treatment = interiorsurvey$Treatment)
view(nmds_data)


plot1 <- ggplot(nmds_data, aes(x = MDS1, y = MDS2)) + 
    geom_point(size = 3, aes( shape = Site, colour = Treatment))+ 
    theme(axis.text.y = element_text(colour = "black", size = 20, face = "bold"), 
    axis.text.x = element_text(colour = "black", face = "bold", size = 20), 
    legend.text = element_text(size = 20, face ="bold", colour ="black"), 
    legend.position = "right", axis.title.y = element_text(face = "bold", size = 20), 
    axis.title.x = element_text(face = "bold", size = 20, colour = "black"), 
    legend.title = element_text(size = 20, colour = "black", face = "bold"), 
    panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, size = 1.2),
    legend.key=element_blank()) + 
    labs(x = "nmds_result", colour = "Treatment", y = "NMDS2", shape = "Site")  + 
    scale_colour_manual(values = c("#009E73", "#E69F00")) 

plot1


#plot2
co=c("red","black") 
shape=c(18,17,16) 
plot(nmds_result$points, col=interiorsurvey$Treatment, pch = interiorsurvey$Site, cex = 0.5, main = "Percent cover per treatment per site", xlab = "axis 1", ylab = "axis 2") 
  Site <- c("Jungle","Dunes") 
  legend('bottomright', Site, pch = c(), cex = 0.5, bty = "y" ) 
  Treatment <- c("Sargassum", "Control") 
  legend('bottomleft', Treatment, col=c("red","black"), pch = c(16), cex = 0.5, bty = "y" )

```
  
###diversity index
```{r} 


survey <- (interiorsurvey[,c(1,3,4,5,6,8:60)])
survey$Block<-as.factor(survey$Block)
survey$Quadrat<-as.factor(survey$Quadrat)
survey$Date<-as.factor(survey$Date)

#merge litter and dead since litter was supposed ot be categorized as dead

survey_data$Dead_Lit <- paste(survey$Dead + survey$Litter)

# Remove the original columns if needed
survey_data <- survey_data[, !(names(survey_data) %in% c("Dead", "Litter"))]

view(survey_data)
# Assuming your dataset is stored in a data frame named 'df'

# Get the column names from the 6th column onwards
species_columns <- names(survey_data)[6:ncol(survey_data)]
view(species_columns)

# Filter out columns with only zeros
non_zero_columns <- species_columns[!apply(survey_data[species_columns], 2, function(x) all(x == 0))]

# Create a new data frame with the non-zero columns
filtered_df <- survey_data[c('Date', 'Site', 'Block', 'Treatment', 'Quadrat', non_zero_columns)]


# Convert the columns to numeric if they are not already
filtered_df[, species_columns] <- lapply(filtered_df[, species_columns], as.numeric)

# Convert numbers to percent cover for each row independently
for (row in 1:nrow(filtered_df)) {
  row_sum <- sum(filtered_df[row, species_columns])
  if (row_sum != 0) {
    filtered_df[row, species_columns] <- (filtered_df[row, species_columns] / row_sum) * 100
  }
}

# Calculate Bray-Curtis dissimilarity matrix
bray_curtis_dist <- vegdist(filtered_df[, species_columns], method = "bray")

# Calculate beta diversity (average dissimilarity) using Bray-Curtis
beta_diversity <- mean(bray_curtis_dist)

# View the calculated beta diversity
beta_diversity

# Assuming your dissimilarity matrix is named 'bray_curtis_dist' and you have the corresponding factors in 'Site', 'Date', and 'Treatment'

# Perform PERMANOVA to compare beta diversity
permanova_result <- adonis2(bray_curtis_dist ~ Site/Treatment + Date, data = filtered_df)


# View the PERMANOVA results
permanova_result

#all significant but we should focus on seeing if there is a treatment effect within each site rather than by between
```

###dune index

```{r}

survey <- (interiorsurvey[,c(1,3,4,5,6,8:60)])
survey$Block<-as.factor(survey$Block)
survey$Quadrat<-as.factor(survey$Quadrat)
survey$Date<-as.factor(survey$Date)

Dunes_survey_data<-subset(survey, Site == "Dunes")
#merge litter and dead since litter was supposed ot be categorized as dead

Dunes_survey_data$Dead_Lit <- paste(Dunes_survey_data$Dead + Dunes_survey_data$Litter)

# Remove the original columns if needed
Dunes_survey_data <- Dunes_survey_data[, !(names(Dunes_survey_data) %in% c("Dead", "Litter"))]


# Get the column names from the 6th column onwards
Dunes_species_columns <- names(Dunes_survey_data)[6:ncol(Dunes_survey_data)]
view(Dunes_species_columns)

# Filter out columns with only zeros
Dunes_non_zero_columns <- Dunes_species_columns[!apply(Dunes_survey_data[Dunes_species_columns], 2, function(x) all(x == 0))]

# Create a new data frame with the non-zero columns
Dunes_filtered_df <- Dunes_survey_data[c('Date', 'Site', 'Block', 'Treatment', 'Quadrat', Dunes_non_zero_columns)]
view(Dunes_filtered_df)


# Convert the columns to numeric if they are not already
Dunes_filtered_df[, Dunes_non_zero_columns] <- lapply(Dunes_filtered_df[, Dunes_non_zero_columns], as.numeric)

# Convert numbers to percent cover for each row independently
for (row in 1:nrow(Dunes_filtered_df)) {
  row_sum <- sum(Dunes_filtered_df[row, Dunes_non_zero_columns])
  if (row_sum != 0) {
    Dunes_filtered_df[row, Dunes_non_zero_columns] <- (Dunes_filtered_df[row, Dunes_non_zero_columns] / row_sum) * 100
  }
}

# Calculate Bray-Curtis dissimilarity matrix
Dunes_bray_curtis_dist <- vegdist(Dunes_filtered_df[, Dunes_non_zero_columns], method = "bray")

# Calculate beta diversity (average dissimilarity) using Bray-Curtis
Dunes_beta_diversity <- mean(Dunes_bray_curtis_dist)

# View the calculated beta diversity
Dunes_beta_diversity

# Assuming your dissimilarity matrix is named 'bray_curtis_dist' and you have the corresponding factors in 'Date', and 'Treatment'

# Perform PERMANOVA to compare beta diversity
Dunes_permanova_result <- adonis2(bray_curtis_dist ~ Treatment/Date, data = Dunes_filtered_df)


# View the PERMANOVA results
Dunes_permanova_result
```


###jungles index

```{r}
survey <- (interiorsurvey[,c(1,3,4,5,6,8:60)])
survey$Block<-as.factor(survey$Block)
survey$Quadrat<-as.factor(survey$Quadrat)
survey$Date<-as.factor(survey$Date)
Jungle_survey_data <- subset(survey, Site == "Jungle")

#merge litter and dead since litter was supposed ot be categorized as dead
Jungle_survey_data$Dead_Lit <- paste(Jungle_survey_data$Dead + Jungle_survey_data$Litter)
# Remove the original columns if needed
Jungle_survey_data <- Jungle_survey_data[, !(names(Jungle_survey_data) %in% c("Dead", "Litter"))]
# Get the column names from the 6th column onwards
Jungle_species_columns <- names(Jungle_survey_data)[6:ncol(Jungle_survey_data)]
view(Jungle_species_columns)
# Filter out columns with only zeros
Jungle_non_zero_columns <- Jungle_species_columns[!apply(Jungle_survey_data[Jungle_species_columns], 2, function(x) all(x == 0))]
# Create a new data frame with the non-zero columns
Jungle_filtered_df <- Jungle_survey_data[c('Date', 'Site', 'Block', 'Treatment', 'Quadrat', Jungle_non_zero_columns)]
view(Jungle_filtered_df)
# Convert the columns to numeric if they are not already
Jungle_filtered_df[, Jungle_non_zero_columns] <- lapply(Jungle_filtered_df[, Jungle_non_zero_columns], as.numeric)
# Convert numbers to percent cover for each row independently
for (row in 1:nrow(Jungle_filtered_df)) {
  row_sum <- sum(Jungle_filtered_df[row, Jungle_non_zero_columns])
  if (row_sum != 0) {
    Jungle_filtered_df[row, Jungle_non_zero_columns] <- (Jungle_filtered_df[row, Jungle_non_zero_columns] / row_sum) * 100
  }
}
# Calculate Bray-Curtis dissimilarity matrix
Jungle_bray_curtis_dist <- vegdist(Jungle_filtered_df[, Jungle_non_zero_columns], method = "bray")
# Calculate beta diversity (average dissimilarity) using Bray-Curtis
Jungle_beta_diversity <- mean(Jungle_bray_curtis_dist)
# View the calculated beta diversity
Jungle_beta_diversity
# Assuming your dissimilarity matrix is named 'bray_curtis_dist' and you have the corresponding factors in 'Date', and 'Treatment'
# Perform PERMANOVA to compare beta diversity
Jungle_permanova_result <- adonis2(bray_curtis_dist ~ Treatment/Date, data = Jungle_filtered_df)
# View the PERMANOVA results
Jungle_permanova_result
#all significant but we should focus on seeing if there is a treatment effect within each site rather than by between

```


```{r}




####for the proposal

#compare communities differences using NMDS
#use only the data we are interested in
##plants first
plants2 <-read.csv("Saragsso Communities2.csv",header=T)
view(plants2)
data2 <- (plants2[,c(4:19,21)])
view(data2)
is.factor(plants2$Type)
plants2$Type<-as.factor(plants2$Type)


#use metaMDS to create NMDS procedure
#make matrix using only the count data relevant for plants
matrix = as.matrix(data2)
view(matrix)
nmds1 = metaMDS(matrix, distance = "bray") 
plot(nmds1)
#a standard NMDS plot lacks any information so lets extract the coordinates and make it more informative
data.scores = as.data.frame(scores(nmds1))
#now lets add descriptive columns back into the data frame 
data.scores$Site = plants2$Site
data.scores$Type = plants2$Type

view(data.scores)

plot2 <- ggplot(data.scores, aes(x = NMDS1, y = NMDS2)) + 
    geom_point(size = 3, aes( shape = Site, colour = Type))+ 
    theme(axis.text.y = element_text(colour = "black", size = 20, face = "bold"), 
    axis.text.x = element_text(colour = "black", face = "bold", size = 20), 
    legend.text = element_text(size = 20, face ="bold", colour ="black"), 
    legend.position = "right", axis.title.y = element_text(face = "bold", size = 20), 
    axis.title.x = element_text(face = "bold", size = 20, colour = "black"), 
    legend.title = element_text(size = 20, colour = "black", face = "bold"), 
    panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, size = 1.2),
    legend.key=element_blank()) + 
    labs(x = "NMDS1", colour = "Type", y = "NMDS2", shape = "Site")  + 
    scale_colour_manual(values = c("#009E73", "#E69F00")) 

plot2
#lets compare chemicals

chems2<-read.csv("Soil Chemicals2.csv", header = T)
view(chems2)

chems3<- chems2 %>%
    group_by(Trt) %>%
    summarize (mean_N = mean(Nitrate), sd_N = sd(Nitrate), count = n(), se_N = (sd_N/(sqrt(count))))
view(chems3)

chemplot3<-ggplot(chems2, aes(x=Site, y=mean_N, fill = Type)) + geom_bar(stat="identity",position=position_dodge()) + theme_bw() + xlab("Site") + ylab("Nitrate (ppm)") + ggtitle(" ") +
    theme(axis.text = element_text(size = 20), axis.title = element_text (size = 20), legend.text = element_text(size = 20), legend.title = element_text(size = 20)) +
    geom_errorbar(aes(ymin = mean_N - se_N, ymax = mean_N + se_N),size=.2, width = .2,  position=position_dodge(0.9))
chemplot3






chems3<-read.csv("Soil Chemicals2.csv", header = T)
view(chems2)

chemplot3<-ggplot(chems2, aes(x=Site, y=Nitrate, fill = Type)) + geom_boxplot() + theme_bw() + xlab("Site") + ylab("Nitrate (ppm)") + ggtitle(" ") 
chemplot3


```

#Carbon and Nitrogen
```{r}

#lets compare C:N

CN<-read.csv("Sargasso CN.csv", header = T)
view(CN)

CNplot<-ggplot(CN, aes(x=site, y=c.n, fill = treatment)) + geom_bar(stat="identity",position=position_dodge()) + theme_bw() + xlab("Site") + ylab("Carbon: 1 Nitrogen") + ggtitle(" ") +
    theme(axis.text = element_text(size = 20), axis.title = element_text (size = 20), legend.text = element_text(size = 20), legend.title = element_text(size = 20)) 
CNplot






CN2<-read.csv("Sargasso CN 3.csv", header = T)
view(CN2)

CNSDS<- CN2 %>%
     group_by(treatment) %>%
    summarize (mean_CN = mean(CN), sd_CN = sd(CN), count = n(), se_CN = (sd_CN/(sqrt(count))))
view(CNSDS)

CNplot2<-ggplot(CN2, aes(x=site, y=mean_CN, fill = Treatment)) + geom_bar(stat="identity",position=position_dodge()) + theme_bw() + xlab("Site") + ylab("Carbon:Nitrogen") + ggtitle(" ") +
    theme(axis.text = element_text(size = 20), axis.title = element_text (size = 20), legend.text = element_text(size = 20), legend.title = element_text(size = 20)) +
    geom_errorbar(aes(ymin = mean_CN - se_CN, ymax = mean_CN + se_CN),size=.2, width = .2,  position=position_dodge(0.9))
CNplot2




#lets re run the old one
old<-read.csv("Soil Chemicals.csv", header = T)
view(old)

oldplot<-ggplot(old, aes(x=Site, y=Nitrate, fill = Dune)) + geom_bar(stat="identity",position=position_dodge()) + theme_bw() + xlab("Site") + ylab("nitrate") + ggtitle(" ") +
    theme(axis.text = element_text(size = 20), axis.title = element_text (size = 20), legend.text = element_text(size = 20), legend.title = element_text(size = 20)) 
oldplot

gitcreds_set()
```

# Plant Community Structure
```{r}
#import dataset
plants<-read.csv("plantcommunity.csv", header = TRUE)
View(plants)

#subset out only the "random" and "interior"  since those are comparable (3 quads each pile interior)
noladder<-subset(plants, !Survey == "Ladder" )
nohilo<-subset(noladder, !Survey == "HiLo")

#subset out the sites
duneinterior<-subset(nohilo, Site == "Dunes")
jungleinterioir<-subset(nohilo, Site == "Jungle")


```








