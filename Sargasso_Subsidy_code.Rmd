---
title: "Sargasso_Subisidy_Code"
output:
  pdf_document: default
  html_document: default
  word_document: default
editor_options:
  chunk_output_type: console
---

#libraries

```{r}
library(knitr)
library(patchwork)
library(tidyverse)
library(tidyr)
library(ggplot2)
library(ggfortify)
library(lme4)
library(lmerTest)
library(car)
library(nlme)
library(ggpubr)
library(multcompView)
library(boot)
library(Hotelling)
library(mvnTest)
library(vegan)
library(factoextra)
library(FactoMineR)
library(agricolae)
library(glmm)
library(HH)
library(ggpubr)
library(rstatix)
library(vegan)
library(effsize)
library(broom)
library(performance)
library(DHARMa)
library(glmmTMB)
library(emmeans)
library(kableExtra)

setwd("~/Documents/GitHub/Sargasso_Subsidy")
#hello

```


# Pile metrics

```{r}
piles <-read.csv("Sargassum_piles.csv",header=T)
piles2<-subset(piles, Treatment== "Sargassum")
piles2$Trip<-as.factor(piles2$Trip)
piles2$Block<-as.factor(piles2$Block)

# Create the box plot
ggplot(piles2, aes(x = Trip, y = ellipsoid_vol, color = Location)) +
  geom_boxplot() 

#histogram
hist(piles2$ellipsoid_vol, main = "Histogram of Variable", xlab = "Variable Values")

# Create a Q-Q plot to assess normality
qqnorm(piles2$ellipsoid_vol)
qqline(piles2$ellipsoid_vol)


# Perform Levene's test for homogeneity of variances
levene_test <- leveneTest(ellipsoid_vol ~ Location, data = piles2)

print(levene_test)


#test if starting size of piles were different
#subset trip 1

view(piles3)
piles3<-subset(piles2, Trip == "1")

t.test(ellipsoid_vol~Location, piles3)

#Pile volume as the response, site as the main between-subjects factor, sampling date as the repeated within-subject 

# Perform the repeated measures ANOVA with original_vol as a covariate

piles_model <- lmer(Ellipsoid_prc_D ~ Trip * Location  + (1|Block), data = piles2)

summary(piles_model)

anova(piles_rm_anova)

#  post hoc pairwise comparisons 
lsmeans_results <- lsmeans(piles_rm_anova, pairwise ~ Trip:Location)

print(lsmeans_results)



view(piles2)

```

### pile figures
```{r}
piles <-read.csv("Sargassum_piles.csv",header=T)
piles2<-subset(piles, Treatment== "Sargassum")
piles2$Trip<-as.factor(piles2$Trip)
piles2$Block<-as.factor(piles2$Block)

# Calculate the means by month and location

mean_data <- piles2 %>%
  group_by(Trip, Location) %>%
  summarize(mean_ellipsoid_vol = mean(Ellipsoid_prc_D))


# Create the scatter plot with mean points connected by a line
vol_scatterplot <- ggplot(data = piles2, aes(x = Trip, y = Ellipsoid_prc_D, fill = Location)) +
  geom_point(size = 2, shape = 21, aes(fill = Location)) +
  geom_line(data = mean_data, aes(x = Trip, y = mean_ellipsoid_vol, group = Location), color = "gray")

# Customize the plot a
vol_x_time<- vol_scatterplot + 
  labs(x = "", y = "Pile volume (%)") +
  scale_color_manual(values = c("black", "white")) +
  scale_fill_manual(values = c("black", "white")) +
   scale_x_discrete(
    limits = c("1", "2", "3", "4"),
    labels = c("1" = "Aug. 22", "2" = "Nov. 22", "3" = "Mar.23", "4" = "Aug.23")
  ) +
  theme_minimal() + 
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines"))
vol_x_time



```


#Decomposer experiment 
##inverts

```{r}

decomp<-read.csv("mesh_bag_inverts.csv",header = T )
decomp$Rep_no.<-as.factor(decomp$Rep_no.)
decomp$Trip<-as.factor(decomp$Trip)

view(decomp)

decomp_inverts<- decomp %>%
  gather(key = "inverts", value = "count", c(5,6,11))

#remove small bags 
decomp_inverts2<-subset(decomp_inverts, Treatment == "large")


#figure out means and SE for graph

decomp_inverts2 %>%
  group_by(Trip, Site, Treatment, inverts) %>%
  summarize(mean_count = mean(count), count_se = sd(count) / sqrt(n())) %>%
  ggplot() +
  aes(x =inverts, y = mean_count, fill = Treatment) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_errorbar(aes(ymin = mean_count - count_se, ymax = mean_count + count_se), 
                position = position_dodge(width = 0.9), width = 0.25) +
  scale_fill_hue(direction = 1) +
 theme_classic() +
  facet_grid(vars(Trip), vars(Site)) +
   theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines"),
    text = element_text(size = 14, color = "black"),
    axis.title = element_text(size = 16, color = "black"),
    axis.text = element_text(size = 14, color = "black"),
    axis.text.x = element_text(size = 14, color = "black"),
    plot.title = element_text(size = 12, color = "black"),
    legend.title = element_text(size = 16, color = "black"),
    legend.text = element_text(size = 14, color = "black"),
    strip.text = element_text(size = 14, color = "black")) +  
  labs(y = "Arthroopod counts", x = "", title = "Mesh bag inverts")


# Calculate the total counts for each group to see how much higher amphipod counts are compared to others at beach on aug 2022
#subset aug 2022
decomp_inverts_aug<-subset(decomp, Trip == "Aug. 22")
#beach
decomp_inverts_aug_beach<- subset(decomp_inverts_aug, Site == "Beach")

total_amphipods <- sum(decomp_inverts_aug_beach$Amphipoda, na.rm = TRUE)
total_arachnids <- sum(decomp_inverts_aug_beach$Arachnida, na.rm = TRUE)
total_hymenopterans <- sum(decomp_inverts_aug_beach$Hymenoptera, na.rm = TRUE)

# Calculate the percentage difference for Amphipods compared to others
percent_difference <- ((total_amphipods - (total_arachnids + total_hymenopterans )) / (total_arachnids + total_hymenopterans )) * 100

# Print the results
cat("percent_difference:", percent_difference, "%\n")



# Fit linear mixed-effects model
decomp_inverts_model<- lm(count ~  inverts + Site * Trip + inverts, data = decomp_inverts2)


# Print model summary
summary(decomp_inverts_model)



# Obtain estimated marginal means
means <- emmeans(decomp_inverts_model, ~ inverts + Site * Trip)

# Perform pairwise comparisons for November 22
pairwise_comparisons <- pairs(means, by = "Site:Trip", infer = c(TRUE, TRUE))

# Print the comparisons
print(pairwise_comparisons)


```

##mesh bags
```{r}

#load data
decomp_bags<-read.csv("mesh_bag_exp.csv",header =T )
decomp_bags$Rep_no.<-as.factor(decomp_bags$Rep_no.)
decomp_bags$Trip<-as.factor(decomp_bags$Trip)
decomp_bags$prc_Delta <- as.numeric(decomp_bags$prc_Delta)


view(decomp_bags)


#quick view counts of percent
ggplot(decomp_bags) +
 aes(x = Trip, fill = Treatment, weight = prc_means) +
 geom_bar(position = "dodge") +
 scale_fill_hue(direction = 1) +
 theme_minimal() +
 facet_grid(vars(Site), vars())


#now lets look at mean values and SE
#subset out trip 1 since its only going to show initial mass which is 100%
decomp_bags %>%
  filter(!(Trip %in% "1")) %>%
  filter(!(ratio %in% "")) %>%
  ggplot() +
  scale_fill_manual(name = "Mesh size", 
                    values = c("large" = "grey25", "small" = "dark gray")) +
  aes(x = Site, fill = Treatment, weight = prc_means) +
  geom_bar(position = "dodge") +
  geom_errorbar(aes(ymin = prc_means - prc_SE, ymax = prc_means + prc_SE), 
                position = position_dodge(width = 0.9), 
                width = 0.25) +  
  labs(y = "Decomposition (% of initial dry biomass)") +
  theme_minimal() +
  facet_grid(Trip ~ ., labeller = labeller(Trip = function(x) ifelse(x == "2", "Nov. 22", ifelse(x == "3", "Mar. 23", x)))) 

view(decomp_bags)


# Fit linear mixed-effects model
decomp_model<- lmer(prc_Delta ~ Site * Treatment * Trip + (1|Bag_ID), data = decomp_bags, na.action = na.exclude)


# Print model summary
summary(decomp_model)


```


#Plant Communities 
## Interior survey

```{r}

interiorsurvey<-read.csv("interior_survey.csv", header = TRUE)

is.factor(interiorsurvey$Treatment)
interiorsurvey$Treatment<-as.factor(interiorsurvey$Treatment)
is.factor(interiorsurvey$Block)
interiorsurvey$Block<-as.factor(interiorsurvey$Block)
interiorsurvey$Trip<-as.factor(interiorsurvey$Trip)


###############################subset out the dunes############################
interior_sub_dune<-subset(interiorsurvey, Site == "Dunes")

#subset trip 1
int_sub_dune_1<-subset(interior_sub_dune, Trip == "1")

# Subset the data for 'Sargassum' and 'Control' treatments
intdune_df_sargassum <- int_sub_dune_1[int_sub_dune_1$Treatment == "sargasso", ]
intdune_df_control <- int_sub_dune_1[int_sub_dune_1$Treatment == "control", ]

### effect sizes for trip 1
cohen.d(intdune_df_sargassum$bermuda,intdune_df_control$bermuda)
cohen.d(intdune_df_sargassum$other_plants,intdune_df_control$other_plants)


#subset trip 2
int_sub_dune_2<-subset(interior_sub_dune, Trip == "2")

# Subset the data for 'Sargassum' and 'Control' treatments
intdune_df_sargassum2 <- int_sub_dune_2[int_sub_dune_2$Treatment == "sargasso", ]
intdune_df_control2 <- int_sub_dune_2[int_sub_dune_2$Treatment == "control", ]

### effect sizes for trip 2
cohen.d(intdune_df_sargassum2$bermuda,intdune_df_control2$bermuda)
cohen.d(intdune_df_sargassum2$other_plants,intdune_df_control2$other_plants)
cohen.d(intdune_df_sargassum2$bare_prc_cover,intdune_df_control2$bare_prc_cover)
cohen.d(intdune_df_sargassum2$leaf_prc_cover,intdune_df_control2$leaf_prc_cover)
cohen.d(intdune_df_sargassum2$other_plant_cover,intdune_df_control2$other_plant_cover)


#subset trip 3
int_sub_dune_3<-subset(interior_sub_dune, Trip == "3")

# Subset the data for 'Sargassum' and 'Control' treatments
intdune_df_sargassum3 <- int_sub_dune_3[int_sub_dune_3$Treatment == "sargasso", ]
intdune_df_control3 <- int_sub_dune_3[int_sub_dune_3$Treatment == "control", ]

### effect sizes for trip 3
cohen.d(intdune_df_sargassum3$bermuda,intdune_df_control3$bermuda)
cohen.d(intdune_df_sargassum3$other_plants,intdune_df_control3$other_plants)
cohen.d(intdune_df_sargassum3$bare_prc_cover,intdune_df_control3$bare_prc_cover)
cohen.d(intdune_df_sargassum3$leaf_prc_cover,intdune_df_control3$leaf_prc_cover)
cohen.d(intdune_df_sargassum3$other_plant_cover,intdune_df_control3$other_plant_cover)


#subset trip 4
int_sub_dune_4<-subset(interior_sub_dune, Trip == "4")

# Subset the data for 'Sargassum' and 'Control' treatments
intdune_df_sargassum4 <- int_sub_dune_4[int_sub_dune_4$Treatment == "sargasso", ]
intdune_df_control4 <- int_sub_dune_4[int_sub_dune_4$Treatment == "control", ]

### effect sizes for trip 4
cohen.d(intdune_df_sargassum4$bermuda,intdune_df_control4$bermuda)
cohen.d(intdune_df_sargassum4$other_plants,intdune_df_control4$other_plants)
cohen.d(intdune_df_sargassum4$bare_prc_cover,intdune_df_control4$bare_prc_cover)
cohen.d(intdune_df_sargassum4$leaf_prc_cover,intdune_df_control4$leaf_prc_cover)
cohen.d(intdune_df_sargassum4$other_plant_cover,intdune_df_control4$other_plant_cover)


###########subset out the Jungle
interior_sub_Jungle<-subset(interiorsurvey, Site == "Jungle")

#subset trip 1
int_sub_Jungle_1<-subset(interior_sub_Jungle, Trip == "1")

# Subset the data for 'Sargassum' and 'Control' treatments
intJungle_df_sargassum <- int_sub_Jungle_1[int_sub_Jungle_1$Treatment == "sargasso", ]
intJungle_df_control <- int_sub_Jungle_1[int_sub_Jungle_1$Treatment == "control", ]

### effect sizes for trip 1
cohen.d(intJungle_df_sargassum$bermuda,intJungle_df_control$bermuda)
cohen.d(intJungle_df_sargassum$total_plant_prc_cover,intJungle_df_control$total_plant_prc_cover)
cohen.d(intJungle_df_sargassum$bare_prc_cover,intJungle_df_control$bare_prc_cover)
cohen.d(intJungle_df_sargassum$leaf_prc_cover,intJungle_df_control$leaf_prc_cover)
cohen.d(intJungle_df_sargassum$other_plants,intJungle_df_control$other_plants)


#subset trip 2
int_sub_Jungle_2<-subset(interior_sub_Jungle, Trip == "2")

# Subset the data for 'Sargassum' and 'Control' treatments
intJungle_df_sargassum2 <- int_sub_Jungle_2[int_sub_Jungle_2$Treatment == "sargasso", ]
intJungle_df_control2 <- int_sub_Jungle_2[int_sub_Jungle_2$Treatment == "control", ]

### effect sizes for trip 2
cohen.d(intJungle_df_sargassum2$bermuda,intJungle_df_control2$bermuda)
cohen.d(intJungle_df_sargassum2$total_plant_prc_cover,intJungle_df_control2$total_plant_prc_cover)
cohen.d(intJungle_df_sargassum2$bare_prc_cover,intJungle_df_control2$bare_prc_cover)
cohen.d(intJungle_df_sargassum2$leaf_prc_cover,intJungle_df_control2$leaf_prc_cover)
cohen.d(intJungle_df_sargassum2$other_plants,intJungle_df_control2$other_plants)

#subset trip 3
int_sub_Jungle_3<-subset(interior_sub_Jungle, Trip == "3")

# Subset the data for 'Sargassum' and 'Control' treatments
intJungle_df_sargassum3 <- int_sub_Jungle_3[int_sub_Jungle_3$Treatment == "sargasso", ]
intJungle_df_control3 <- int_sub_Jungle_3[int_sub_Jungle_3$Treatment == "control", ]

### effect sizes for trip 3
cohen.d(intJungle_df_sargassum3$bermuda,intJungle_df_control3$bermuda)
cohen.d(intJungle_df_sargassum3$total_plant_prc_cover,intJungle_df_control3$total_plant_prc_cover)
cohen.d(intJungle_df_sargassum3$bare_prc_cover,intJungle_df_control3$bare_prc_cover)
cohen.d(intJungle_df_sargassum3$leaf_prc_cover,intJungle_df_control3$leaf_prc_cover)
cohen.d(intJungle_df_sargassum3$other_plants,intJungle_df_control3$other_plants)



#subset trip 4
int_sub_Jungle_4<-subset(interior_sub_Jungle, Trip == "4")

# Subset the data for 'Sargassum' and 'Control' treatments
intJungle_df_sargassum4 <- int_sub_Jungle_4[int_sub_Jungle_4$Treatment == "sargasso", ]
intJungle_df_control4 <- int_sub_Jungle_4[int_sub_Jungle_4$Treatment == "control", ]

### effect sizes for trip 4
cohen.d(intJungle_df_sargassum4$bermuda,intJungle_df_control4$bermuda)
cohen.d(intJungle_df_sargassum4$total_plant_prc_cover,intJungle_df_control4$total_plant_prc_cover)
cohen.d(intJungle_df_sargassum4$bare_prc_cover,intJungle_df_control4$bare_prc_cover)
cohen.d(intJungle_df_sargassum4$leaf_prc_cover,intJungle_df_control4$leaf_prc_cover)
cohen.d(intJungle_df_sargassum4$other_plants,intJungle_df_control4$other_plants)


```

###percent cover
```{r}

#import dataset
interiorrsurvey<-read.csv("interior_survey.csv", header = TRUE)

interior_survey_long<- interiorsurvey %>%
  gather(key = "cover_type", value = "percent_cover", c(57,60))
interior_survey_long$Trip<-as.factor(interior_survey_long$Trip)

plant_int_data <- interior_survey_long %>%
  group_by(Trip,Site,Treatment,cover_type) %>%
  summarize(mean_cover = mean(percent_cover), se = sd(percent_cover) / sqrt(n()))
view(plant_int_data)


#graph it
interior_pc_cover<- ggplot(data = interior_survey_long,
            aes(
              x = Trip,
              y = percent_cover,
              shape = cover_type,
              color = Treatment
            )) +
  stat_summary(geom = "point", fun = mean, position = position_dodge(width = 1),
               size = 2L, stroke = 1) +
  stat_summary(geom = "errorbar", fun.data = mean_se, position = position_dodge(width = 1),
               width = 0.2) +  # Adjust the width of the error bars as needed
  labs(
    x = " ",
    y = "Mean Percent Cover",
    title = "Interior Mean Percent Cover",
    shape = "Cover type"
  ) +
  scale_x_discrete(
    limits = c("1", "2", "3", "4"),
    labels = c("1" = "Aug. 22", "2" = "Nov. 22", "3" = "Mar. 23", "4" = "Aug. 23")
  ) +
  facet_grid(vars(), vars(Site)) +
  theme_minimal() +
  scale_fill_manual(values = c("grey44", "black")) +
  scale_color_manual(values = c("grey44", "black")) +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines")
  )

interior_pc_cover



```

###effect sizes
````{r}

interioreffsize1 <-read.csv("interior_graphs.csv",header=T)
interioreffsize <-subset(interioreffsize1, Data == "eff_size")

interioreffsize<-subset(interioreffsize, !Cover == "all_plants")
interioreffsize<-subset(interioreffsize, !Cover ==  "bare" ) 
interioreffsize<-subset(interioreffsize, !Cover == "leaf_litter")
interioreffsize$Trip<-as.factor(interioreffsize$Trip)
interioreffsize$Effect_size<-as.numeric(interioreffsize$Effect_size)


int_eff_plot <- ggplot(interioreffsize, aes(x = Trip, y = Effect_size, shape = Cover)) +
  labs(y = "Effect size", title = "") +
  geom_path(aes(group = Cover), position = position_dodge(0.5), color = "dark gray") +
  theme_bw() +
  facet_wrap(vars(Site), ncol = 2L) +
  geom_point(color = "black", size = 3, position = position_dodge(0.5)) +
  scale_x_discrete(
    limits = c("1", "2", "3", "4"),
    labels = c("1" = "Aug. 22", "2" = "Nov. 22", "3" = "Mar.23", "4" = "Aug.23")
  ) +
    scale_shape_discrete(labels = c("grass", "other plants")) +
  theme(
    axis.text = element_text(size = 12),
    axis.title = element_text(size = 12),
    plot.title = element_text(size = 12),
    axis.text.x = element_text(size = 12),
    strip.text = element_text(size = 12)
  ) +
  xlab("") +
    theme_minimal()  +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines"))

int_eff_plot


```

## Perimeter Survey
```{r}

perimetersurvey<-read.csv("perimeter_survey.csv", header = TRUE)

perimetersurvey$Treatment<-as.factor(perimetersurvey$Treatment)
perimetersurvey$Block<-as.factor(perimetersurvey$Block)
perimetersurvey$Trip<-as.factor(perimetersurvey$Trip)

###########subset out the dunes
perimeter_sub_dune<-subset(perimetersurvey, Site == "Dunes")

#subset trip 1
per_sub_dune_1<-subset(perimeter_sub_dune, Trip == "1")

# Subset the data for 'Sargassum' and 'Control' treatments
perdune_df_sargassum <- per_sub_dune_1[per_sub_dune_1$Treatment == "sargasso", ]
perdune_df_control <- per_sub_dune_1[per_sub_dune_1$Treatment == "control", ]

### effect sizes for trip 1
cohen.d(perdune_df_sargassum$bermuda,perdune_df_control$bermuda)
cohen.d(perdune_df_sargassum$other_plants,perdune_df_control$other_plants)
cohen.d(perdune_df_sargassum$total_plant_prc_cover,perdune_df_control$total_plant_prc_cover)
cohen.d(perdune_df_sargassum$bare_prc_cover,perdune_df_control$bare_prc_cover)
cohen.d(perdune_df_sargassum$dead_prc_cover,perdune_df_control$dead_prc_cover)



#subset trip 2
per_sub_dune_2<-subset(perimeter_sub_dune, Trip == "2")

# Subset the data for 'Sargassum' and 'Control' treatments
perdune_df_sargassum2 <- per_sub_dune_2[per_sub_dune_2$Treatment == "sargasso", ]
perdune_df_control2 <- per_sub_dune_2[per_sub_dune_2$Treatment == "control", ]

### effect sizes for trip 2
cohen.d(perdune_df_sargassum2$bermuda,perdune_df_control2$bermuda)
cohen.d(perdune_df_sargassum2$other_plants,perdune_df_control2$other_plants)
cohen.d(perdune_df_sargassum2$total_plant_prc_cover,perdune_df_control2$total_plant_prc_cover)
cohen.d(perdune_df_sargassum2$bare_prc_cover,perdune_df_control2$bare_prc_cover)
cohen.d(perdune_df_sargassum2$dead_prc_cover,perdune_df_control2$dead_prc_cover)



#subset trip 3
per_sub_dune_3<-subset(perimeter_sub_dune, Trip == "3")

# Subset the data for 'Sargassum' and 'Control' treatments
perdune_df_sargassum3 <- per_sub_dune_3[per_sub_dune_3$Treatment == "sargasso", ]
perdune_df_control3 <- per_sub_dune_3[per_sub_dune_3$Treatment == "control", ]

### effect sizes for trip 3
cohen.d(perdune_df_sargassum3$bermuda,perdune_df_control3$bermuda)
cohen.d(perdune_df_sargassum3$other_plants,perdune_df_control3$other_plants)
cohen.d(perdune_df_sargassum3$total_plant_prc_cover,perdune_df_control3$total_plant_prc_cover)
cohen.d(perdune_df_sargassum3$bare_prc_cover,perdune_df_control3$bare_prc_cover)
cohen.d(perdune_df_sargassum3$dead_prc_cover,perdune_df_control3$dead_prc_cover)


#subset trip 4
per_sub_dune_4<-subset(perimeter_sub_dune, Trip == "4")

# Subset the data for 'Sargassum' and 'Control' treatments
perdune_df_sargassum4 <- per_sub_dune_4[per_sub_dune_4$Treatment == "sargasso", ]
perdune_df_control4 <- per_sub_dune_4[per_sub_dune_4$Treatment == "control", ]

### effect sizes for trip 4
cohen.d(perdune_df_sargassum4$bermuda,perdune_df_control4$bermuda)
cohen.d(perdune_df_sargassum$other_plants,perdune_df_control4$other_plants)
cohen.d(perdune_df_sargassum4$total_plant_prc_cover,perdune_df_control4$total_plant_prc_cover)
cohen.d(perdune_df_sargassum4$bare_prc_cover,perdune_df_control4$bare_prc_cover)
cohen.d(perdune_df_sargassum4$dead_prc_cover,perdune_df_control4$dead_prc_cover)


###########subset out the Jungle
perimeter_sub_Jungle<-subset(perimetersurvey, Site == "Jungle")

#subset trip 1
per_sub_Jungle_1<-subset(perimeter_sub_Jungle, Trip == "1")

# Subset the data for 'Sargassum' and 'Control' treatments
perJungle_df_sargassum <- per_sub_Jungle_1[per_sub_Jungle_1$Treatment == "sargasso", ]
perJungle_df_control <- per_sub_Jungle_1[per_sub_Jungle_1$Treatment == "control", ]

### effect sizes for trip 1
cohen.d(perJungle_df_sargassum$bermuda,perJungle_df_control$bermuda)
cohen.d(perJungle_df_sargassum$other_plants,perJungle_df_control$other_plants)
cohen.d(perJungle_df_sargassum$total_plant_prc_cover,perJungle_df_control$total_plant_prc_cover)
cohen.d(perJungle_df_sargassum$bare_prc_cover,perJungle_df_control$bare_prc_cover)
cohen.d(perJungle_df_sargassum$dead_prc_cover,perJungle_df_control$dead_prc_cover)


#subset trip 2
per_sub_Jungle_2<-subset(perimeter_sub_Jungle, Trip == "2")

# Subset the data for 'Sargassum' and 'Control' treatments
perJungle_df_sargassum2 <- per_sub_Jungle_2[per_sub_Jungle_2$Treatment == "sargasso", ]
perJungle_df_control2 <- per_sub_Jungle_2[per_sub_Jungle_2$Treatment == "control", ]

### effect sizes for trip 2
cohen.d(perJungle_df_sargassum2$bermuda,perJungle_df_control2$bermuda)
cohen.d(perJungle_df_sargassum2$other_plants,perJungle_df_control2$other_plants)
cohen.d(perJungle_df_sargassum2$total_plant_prc_cover,perJungle_df_control2$total_plant_prc_cover)
cohen.d(perJungle_df_sargassum2$bare_prc_cover,perJungle_df_control2$bare_prc_cover)
cohen.d(perJungle_df_sargassum2$dead_prc_cover,perJungle_df_control2$dead_prc_cover)


#subset trip 3
per_sub_Jungle_3<-subset(perimeter_sub_Jungle, Trip == "3")

# Subset the data for 'Sargassum' and 'Control' treatments
perJungle_df_sargassum3 <- per_sub_Jungle_3[per_sub_Jungle_3$Treatment == "sargasso", ]
perJungle_df_control3 <- per_sub_Jungle_3[per_sub_Jungle_3$Treatment == "control", ]

### effect sizes for trip 3
cohen.d(perJungle_df_sargassum3$bermuda,perJungle_df_control3$bermuda)
cohen.d(perJungle_df_sargassum3$other_plants,perJungle_df_control3$other_plants)
cohen.d(perJungle_df_sargassum3$total_plant_prc_cover,perJungle_df_control3$total_plant_prc_cover)
cohen.d(perJungle_df_sargassum3$bare_prc_cover,perJungle_df_control3$bare_prc_cover)
cohen.d(perJungle_df_sargassum3$dead_prc_cover,perJungle_df_control3$dead_prc_cover)


#subset trip 4
per_sub_Jungle_4<-subset(perimeter_sub_Jungle, Trip == "4")

# Subset the data for 'Sargassum' and 'Control' treatments
perJungle_df_sargassum4 <- per_sub_Jungle_4[per_sub_Jungle_4$Treatment == "sargasso", ]
perJungle_df_control4 <- per_sub_Jungle_4[per_sub_Jungle_4$Treatment == "control", ]

### effect sizes for trip 4
cohen.d(perJungle_df_sargassum4$bermuda,perJungle_df_control4$bermuda)
cohen.d(perJungle_df_sargassum4$other_plants,perJungle_df_control4$other_plants)
cohen.d(perJungle_df_sargassum4$total_plant_prc_cover,perJungle_df_control4$total_plant_prc_cover)
cohen.d(perJungle_df_sargassum4$bare_prc_cover,perJungle_df_control4$bare_prc_cover)
cohen.d(perJungle_df_sargassum4$dead_prc_cover,perJungle_df_control4$dead_prc_cover)



```



###percent cover
```{r}

#import dataset
perimetersurvey<-read.csv("perimeter_survey.csv", header = TRUE)

perimeter_survey_long<- perimetersurvey %>%
  gather(key = "cover_type", value = "percent_cover", c(60,61))
perimeter_survey_long$Trip<-as.factor(perimeter_survey_long$Trip)


plant_per_data <- perimeter_survey_long %>%
  group_by(Trip,Site,Treatment,cover_type) %>%
  summarize(mean_cover = mean(percent_cover), se = sd(percent_cover) / sqrt(n()))
view(plant_per_data)

#graph it


perimeter_pc_cover<- ggplot(data = perimeter_survey_long,
            aes(
              x = Trip,
              y = percent_cover,
              shape = cover_type,
              color = Treatment
            )) +
  stat_summary(geom = "point", fun = mean, position = position_dodge(width = 1),
               size = 2L, stroke = 1) +
  stat_summary(geom = "errorbar", fun.data = mean_se, position = position_dodge(width = 1),
               width = 0.2) +  # error bars
  labs(
    x = " ",
    y = "Mean Percent Cover",
    title = "perimeter Mean Percent Cover",
    shape = "Cover type"
  ) +
  scale_x_discrete(
    limits = c("1", "2", "3", "4"),
    labels = c("1" = "Aug. 22", "2" = "Nov. 22", "3" = "Mar. 23", "4" = "Aug. 23")
  ) +
  facet_grid(vars(), vars(Site)) +
  theme_minimal() +
  scale_fill_manual(values = c("grey44", "black")) +
  scale_color_manual(values = c("grey44", "black")) +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines")
  )

perimeter_pc_cover


```


###effect sizes
````{r}

perimetereffsize1 <-read.csv("perimeter_graphs.csv",header=T)
perimetereffsize <-subset(perimetereffsize1, Data == "eff_size")

perimetereffsize<-subset(perimetereffsize, !Cover == "all_plants")
perimetereffsize<-subset(perimetereffsize, !Cover ==  "dead" ) 
perimetereffsize<-subset(perimetereffsize, !Cover ==  "bare" ) 
perimetereffsize$Trip<-as.factor(perimetereffsize$Trip)
perimetereffsize$Effect_size<-as.numeric(perimetereffsize$Effect_size)


per_eff_plot <- ggplot(perimetereffsize, aes(x = Trip, y = Effect_size, shape = Cover)) +
  labs(y = "Effect size", title = "") +
  geom_path(aes(group = Cover), position = position_dodge(0.5), color = "dark gray") +
  theme_bw() +
  facet_wrap(vars(Site), ncol = 2L) +
  geom_point(color = "black", size = 3, position = position_dodge(0.5)) +
  scale_x_discrete(
    limits = c("1", "2", "3", "4"),
    labels = c("1" = "Aug. 22", "2" = "Nov. 22", "3" = "Mar.23", "4" = "Aug.23")
  ) +
    scale_shape_discrete(labels = c("grass", "other plants")) +
  theme(
    axis.text = element_text(size = 12),
    axis.title = element_text(size = 12),
    plot.title = element_text(size = 12),
    axis.text.x = element_text(size = 12),
    strip.text = element_text(size = 12)
  ) +
  xlab("") +
    theme_minimal()  +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines"))

per_eff_plot


```



###Plant community nMDS 

```{r}
#upload and subset data for interior surveys 
#import dataset
plants<-read.csv("plantcommunity_NMDS.csv", header = TRUE)

#subset out only the "random" and "interior"  since those are comparable (3 quads each pile interior)
noladder<-subset(plants, !Survey == "Ladder" )
interiorsurvey<-subset(noladder, !Survey == "HiLo")
is.factor(interiorsurvey$Treatment)
interiorsurvey$Treatment<-as.factor(interiorsurvey$Treatment)
is.factor(interiorsurvey$Block)
interiorsurvey$Block<-as.factor(interiorsurvey$Block)
#compare communities differences using NMDS
#use only the data we are interested in
##plants first
nm <- (interiorsurvey[,c(8:60)])
#make matrix
matrix = as.matrix(nm)
nmds_result = metaMDS(matrix, distance = "bray")
plot(nmds_result)


# Create a new data frame with NMDS coordinates, grouping, and additional descriptor information
nmds_data <- data.frame(nmds_result$points, Site = interiorsurvey$Site, Treatment = interiorsurvey$Treatment)


plot1 <- ggplot(nmds_data, aes(x = MDS1, y = MDS2)) + 
    geom_point(size = 3, aes( shape = Site, colour = Treatment))+ 
    theme(axis.text.y = element_text(colour = "black", size = 12, face = "bold"), 
    axis.text.x = element_text(colour = "black", face = "bold", size = 20), 
    legend.text = element_text(size = 12, face ="bold", colour ="black"), 
    legend.position = "right", axis.title.y = element_text(face = "bold", size = 20), 
    axis.title.x = element_text(face = "bold", size = 12, colour = "black"), 
    legend.title = element_text(size = 12, colour = "black", face = "bold"), 
    panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, size = 1.2),
    legend.key=element_blank()) + 
    labs(x = "nmds_result", colour = "Treatment", y = "NMDS2", shape = "Site")  + 
    scale_colour_manual(values = c("#009E73", "#E69F00")) 

plot1


#plot2
co=c("red","black") 
shape=c(18,17,16) 
plot(nmds_result$points, col=interiorsurvey$Treatment, pch = interiorsurvey$Site, cex = 0.5, main = "Percent cover per treatment per site", xlab = "axis 1", ylab = "axis 2") 
  Site <- c("Jungle","Dunes") 
  legend('bottomright', Site, pch = c(), cex = 0.5, bty = "y" ) 
  Treatment <- c("Sargassum", "Control") 
  legend('bottomleft', Treatment, col=c("red","black"), pch = c(16), cex = 0.5, bty = "y" )



###diversity index




survey <- (interiorsurvey[,c(1,3,4,5,6,8:60)])
survey$Block<-as.factor(survey$Block)
survey$Quadrat<-as.factor(survey$Quadrat)
survey$Trip<-as.factor(survey$Trip)



###dune index



survey <- (interiorsurvey[,c(1,3,4,5,6,8:60)])
survey$Block<-as.factor(survey$Block)
survey$Quadrat<-as.factor(survey$Quadrat)
survey$Trip<-as.factor(survey$Trip)

Dunes_survey_data<-subset(survey, Site == "Dunes")
#merge litter and dead since litter was supposed to be categorized as dead

Dunes_survey_data$Dead_Lit <- paste(Dunes_survey_data$Dead + Dunes_survey_data$Litter)

# Remove the original columns if needed
Dunes_survey_data <- Dunes_survey_data[, !(names(Dunes_survey_data) %in% c("Dead", "Litter"))]


# Get the column names from the 6th column onwards
Dunes_species_columns <- names(Dunes_survey_data)[6:ncol(Dunes_survey_data)]

# Filter out columns with only zeros
Dunes_non_zero_columns <- Dunes_species_columns[!apply(Dunes_survey_data[Dunes_species_columns], 2, function(x) all(x == 0))]

# Create a new data frame with the non-zero columns
Dunes_filtered_df <- Dunes_survey_data[c('Trip', 'Site', 'Block', 'Treatment', 'Quadrat', Dunes_non_zero_columns)]
view(Dunes_filtered_df)


# Convert the columns to numeric if they are not already
Dunes_filtered_df[, Dunes_non_zero_columns] <- lapply(Dunes_filtered_df[, Dunes_non_zero_columns], as.numeric)

# Convert numbers to percent cover for each row independently
for (row in 1:nrow(Dunes_filtered_df)) {
  row_sum <- sum(Dunes_filtered_df[row, Dunes_non_zero_columns])
  if (row_sum != 0) {
    Dunes_filtered_df[row, Dunes_non_zero_columns] <- (Dunes_filtered_df[row, Dunes_non_zero_columns] / row_sum) * 100
  }
}

# Calculate Bray-Curtis dissimilarity matrix
Dunes_bray_curtis_dist <- vegdist(Dunes_filtered_df[, Dunes_non_zero_columns], method = "bray")

# Calculate beta diversity (average dissimilarity) using Bray-Curtis
Dunes_beta_diversity <- mean(Dunes_bray_curtis_dist)

# View the calculated beta diversity
Dunes_beta_diversity

# Assuming your dissimilarity matrix is named 'bray_curtis_dist' and you have the corresponding factors in 'Trip', and 'Treatment'

# Perform PERMANOVA to compare beta diversity
Dunes_permanova_result <- adonis2(Dunes_bray_curtis_dist ~ Treatment/Trip, data = Dunes_filtered_df)


# View the PERMANOVA results
Dunes_permanova_result


###jungles index


survey <- (interiorsurvey[,c(1,3,4,5,6,8:60)])
survey$Block<-as.factor(survey$Block)
survey$Quadrat<-as.factor(survey$Quadrat)
survey$Trip<-as.factor(survey$Trip)
Jungle_survey_data <- subset(survey, Site == "Jungle")

#merge litter and dead since litter was supposed ot be categorized as dead
Jungle_survey_data$Dead_Lit <- paste(Jungle_survey_data$Dead + Jungle_survey_data$Litter)
# Remove the original columns if needed
Jungle_survey_data <- Jungle_survey_data[, !(names(Jungle_survey_data) %in% c("Dead", "Litter"))]
# Get the column names from the 6th column onwards
Jungle_species_columns <- names(Jungle_survey_data)[6:ncol(Jungle_survey_data)]
view(Jungle_species_columns)
# Filter out columns with only zeros
Jungle_non_zero_columns <- Jungle_species_columns[!apply(Jungle_survey_data[Jungle_species_columns], 2, function(x) all(x == 0))]
# Create a new data frame with the non-zero columns
Jungle_filtered_df <- Jungle_survey_data[c('Trip', 'Site', 'Block', 'Treatment', 'Quadrat', Jungle_non_zero_columns)]
view(Jungle_filtered_df)
# Convert the columns to numeric if they are not already
Jungle_filtered_df[, Jungle_non_zero_columns] <- lapply(Jungle_filtered_df[, Jungle_non_zero_columns], as.numeric)
# Convert numbers to percent cover for each row independently
for (row in 1:nrow(Jungle_filtered_df)) {
  row_sum <- sum(Jungle_filtered_df[row, Jungle_non_zero_columns])
  if (row_sum != 0) {
    Jungle_filtered_df[row, Jungle_non_zero_columns] <- (Jungle_filtered_df[row, Jungle_non_zero_columns] / row_sum) * 100
  }
}
# Calculate Bray-Curtis dissimilarity matrix
Jungle_bray_curtis_dist <- vegdist(Jungle_filtered_df[, Jungle_non_zero_columns], method = "bray")
# Calculate beta diversity (average dissimilarity) using Bray-Curtis
Jungle_beta_diversity <- mean(Jungle_bray_curtis_dist)
# View the calculated beta diversity
Jungle_beta_diversity
# Assuming your dissimilarity matrix is named 'bray_curtis_dist' and you have the corresponding factors in 'Trip', and 'Treatment'
# Perform PERMANOVA to compare beta diversity
Jungle_permanova_result <- adonis2(Jungle_bray_curtis_dist ~ Treatment/Trip, data = Jungle_filtered_df)
# View the PERMANOVA results
Jungle_permanova_result
#all significant but we should focus on seeing if there is a treatment effect within each site rather than by between

```

##Ladder

```{r}
ladder<-read.csv("ladder.csv", header = TRUE)
ladder$Trip<-as.factor(ladder$Trip)
ladder$Quadrat<-as.factor(ladder$Quadrat)

#make data long 
laddersurvey_long <- gather(ladder, key = "cover_type", value = "percent_cover", 10:11, -c(1:5),) 
#use this for graphing purposes
laddersurvey_long$percent_cover<-as.numeric(laddersurvey_long$percent_cover)
laddersurvey_long$Trip<-as.factor(laddersurvey_long$Trip)
laddersurvey_long$Quadrat <- as.factor(laddersurvey_long$Quadrat)

#graph it
#lets look at the distance effect of sargassum on percent cover of grass and all other plants in the jungle 


ladder<- laddersurvey_long %>%
  ggplot() +
  aes(x = Dist_from_edge, y = percent_cover, fill = cover_type) +
  stat_summary(
    fun.y = "mean",
    geom = "bar",
    position = "dodge",
    width = 0.7
  ) +
  stat_summary(
    fun.data = mean_se,
    geom = "errorbar",
    position = position_dodge(width = 0.7),
    width = 0.25
  ) +
  scale_fill_hue(direction = 1) +
  labs(
    x = "Distance from plot (m)",
    y = "Percent cover",
    fill = "Cover type") +
  theme_minimal() +
  facet_grid(vars(Trip), vars(Site), scales = "free")

ladder

 

laddersurvey_long %>%
filter(Quadrat != "0") %>%
  ggplot(aes(x = Quadrat, fill = Treatment, y = percent_cover)) +
  geom_bar(position = "dodge", stat = "identity") +
  stat_summary(
    fun.data = "mean_se",
    geom = "errorbar",
    position = position_dodge(width = 0.7),
    width = 0.25
  ) +
  theme_minimal() +
  facet_grid(vars(Trip), vars(Site))


# Convert Quadrat to a factor to ensure correct grouping
laddersurvey_long$Quadrat <- as.factor(laddersurvey_long$Quadrat)
# remove the "0" treatment since those data are used toward the perimieter surveys and we are now interested in seeing if there is a treatment effect BEYOND those

laddersurvey_dist<-subset(laddersurvey_long, !Quadrat == "0")

# Fit a linear mixed-effects model
ladder_lm <- lm(percent_cover ~ Treatment + Site * Quadrat * Trip , data = laddersurvey_dist)

# Print model summary
summary(ladder_lm)

# Perform an analysis of variance (ANOVA) to test the significance of the Treatment term
ladder_anova_result <- anova(ladder_lm)

# Print the ANOVA table
print(ladder_anova_result)

   
```



#Arthropods

##pitfalls

```{r}
#load data
pitfalls <-read.csv("Pitfalls.csv",header=T)
pitfalls_long<- pitfalls %>%
  gather(key = "Taxa", value = "Count", c(8,13,15))
pitfalls_long$Trip<-as.factor(pitfalls_long$Trip)


#fix names and calculate Mean and SE

pitfalls_data <- pitfalls_long %>%
  mutate(
    Site = ifelse(Site == "Dune", "Beach", ifelse(Site == "Jungle", "Forest", Site)),
    Trip = case_when(
      Trip == 1 ~ "Aug. 22",
      Trip == 2 ~ "Nov. 22",
      Trip == 3 ~ "Mar. 23",
      TRUE ~ as.character(Trip)  
    ),
    Treatment = case_when(
      Treatment == "Control" ~ "control",
      Treatment == "Sargassum" ~ "sargasso",
      TRUE ~ as.character(Treatment)  
    )
  ) %>%
  group_by(Site, Trip, Treatment, Taxa) %>%
  summarize(
    Mean = round(mean(Count), digits = 2), 
    SE = round(sd(Count) / sqrt(n()), digits = 2)  
  )

view(pitfalls_data)

#make data wide by "Site"
pit_wide_data <- pitfalls_data %>%
  pivot_wider(
    id_cols = c("Trip", "Treatment", "Taxa"),
    names_from = Site,
    values_from = c(Mean, SE),
    names_glue = "{Site}_{.value}")

View(pit_wide_data)


#make wider by Trip
pit_wide_data2 <- pit_wide_data %>%
  pivot_wider(
    id_cols = c( "Treatment", "Taxa"),
    names_from = Trip,
    values_from = c(Beach_Mean, Beach_SE,
    Forest_Mean, Forest_SE),
    names_glue = "{Trip}_{.value}" )

view(pit_wide_data2)

#make sure Means are next to related SEs
pit_wide_data3 <- pit_wide_data2 %>%
  select(
    # List the columns in order
    "Taxa", "Treatment",
    "Aug. 22_Beach_Mean", "Aug. 22_Beach_SE",
    "Nov. 22_Beach_Mean", "Nov. 22_Beach_SE",
    "Mar. 23_Beach_Mean", "Mar. 23_Beach_SE",
    "Aug. 22_Forest_Mean", "Aug. 22_Forest_SE",
    "Nov. 22_Forest_Mean", "Nov. 22_Forest_SE",
    "Mar. 23_Forest_Mean", "Mar. 23_Forest_SE",)

View(pit_wide_data3)

# Rename the orders in Taxa
pit_wide_data3 <- pit_wide_data3 %>%
  mutate(
    Taxa = case_when(
      Taxa == "Amphipods" ~ "Amphipoda",
      Taxa == "Arachnid" ~ "Arachnida",
      Taxa == "Hymenoptera" ~ "Hymenoptera",
      TRUE ~ Taxa  # Keep other values as is
    )
  )
#order by Taxa
pit_wide_data3 <- pit_wide_data3 %>%
  arrange(Taxa)

#Rename columns to just show Mean and SE
### !!!!important!!!! notice i staggered spaces in the name so that i can use the same column names for all Means and SEs
pit_wide_data4 <- pit_wide_data3 %>%
  rename(
     "Mean" = "Aug. 22_Beach_Mean", "SE   " = "Aug. 22_Beach_SE",
     " Mean" = "Nov. 22_Beach_Mean", "SE  " = "Nov. 22_Beach_SE",
     "  Mean" = "Mar. 23_Beach_Mean", "SE " = "Mar. 23_Beach_SE",
     "Mean " = "Aug. 22_Forest_Mean", "  SE"  = "Aug. 22_Forest_SE",
     "Mean  " = "Nov. 22_Forest_Mean", " SE" = "Nov. 22_Forest_SE",
     "Mean   " = "Mar. 23_Forest_Mean", "SE" = "Mar. 23_Forest_SE")


kbl(pit_wide_data4) %>%
  kable_classic("striped", full_width = T)%>%
  add_header_above(c(" " = 2, "Aug. 22" = 2, "Nov. 22" = 2, "Mar. 23" = 2, "Aug. 22" = 2, "Nov. 22" = 2, "Mar. 23" = 2)) %>%
  add_header_above(c(" " = 2, "Beach" = 6, "Forest" = 6)) 





```
####pitfalls analysis

```{r}

pitfallsmod1 <-read.csv("Pitfalls.csv",header=T)

############################################dunes############################################
#subset out the dunes
piteff_sub_dune<-subset(pitfallsmod1, Site == "Dune")

#subset trip 1
piteff_sub_dune_1<-subset(piteff_sub_dune, Trip == "1")

# Subset the data for 'Sargassum' and 'Control' treatments
pitdune_df_sargassum <- piteff_sub_dune_1[piteff_sub_dune_1$Treatment == "Sargassum", ]
pitdune_df_control <- piteff_sub_dune_1[piteff_sub_dune_1$Treatment == "Control", ]

### effect sizes for trip 1
cohen.d(pitdune_df_sargassum$Amphipods,pitdune_df_control$Amphipods)
cohen.d(pitdune_df_sargassum$Arachnid,pitdune_df_control$Arachnid)
cohen.d(pitdune_df_sargassum$Hymenoptera,pitdune_df_control$Hymenoptera)


#subset trip 2
piteff_sub_dune_2<-subset(piteff_sub_dune, Trip == "2")

# Subset the data for 'Sargassum' and 'Control' treatments
pitdune_df_sargassum2 <- piteff_sub_dune_2[piteff_sub_dune_2$Treatment == "Sargassum", ]
pitdune_df_control2 <- piteff_sub_dune_2[piteff_sub_dune_2$Treatment == "Control", ]

### effect sizes for trip 2
cohen.d(pitdune_df_sargassum2$Amphipods,pitdune_df_control2$Amphipods)
cohen.d(pitdune_df_sargassum2$Arachnid,pitdune_df_control2$Arachnid)
cohen.d(pitdune_df_sargassum2$Hymenoptera,pitdune_df_control2$Hymenoptera)

#subset trip 3
piteff_sub_dune_3<-subset(piteff_sub_dune, Trip == "3")

# Subset the data for 'Sargassum' and 'Control' treatments
pitdune_df_sargassum3 <- piteff_sub_dune_3[piteff_sub_dune_3$Treatment == "Sargassum", ]
pitdune_df_control3 <- piteff_sub_dune_3[piteff_sub_dune_3$Treatment == "Control", ]

### effect sizes for trip 3
cohen.d(pitdune_df_sargassum3$Amphipods,pitdune_df_control3$Amphipods)
cohen.d(pitdune_df_sargassum3$Arachnid,pitdune_df_control3$Arachnid)
cohen.d(pitdune_df_sargassum3$Hymenoptera,pitdune_df_control3$Hymenoptera)


############################################jungle############################################
#subset out the dunes
piteff_sub_jungle<-subset(pitfallsmod1, Site == "Jungle")

#subset trip 1
piteff_sub_jungle_1<-subset(piteff_sub_jungle, Trip == "1")

# Subset the data for 'Sargassum' and 'Control' treatments
pitjungle_df_sargassum <- piteff_sub_jungle_1[piteff_sub_jungle_1$Treatment == "Sargassum", ]
pitjungle_df_control <- piteff_sub_jungle_1[piteff_sub_jungle_1$Treatment == "Control", ]

### effect sizes for trip 1
cohen.d(pitjungle_df_sargassum$Amphipods,pitjungle_df_control$Amphipods)
cohen.d(pitjungle_df_sargassum$Arachnid,pitjungle_df_control$Arachnid)
cohen.d(pitjungle_df_sargassum$Hymenoptera,pitjungle_df_control$Hymenoptera)

#subset trip 2
piteff_sub_jungle_2<-subset(piteff_sub_jungle, Trip == "2")

# Subset the data for 'Sargassum' and 'Control' treatments
pitjungle_df_sargassum2 <- piteff_sub_jungle_2[piteff_sub_jungle_2$Treatment == "Sargassum", ]
pitjungle_df_control2 <- piteff_sub_jungle_2[piteff_sub_jungle_2$Treatment == "Control", ]

### effect sizes for trip 2
cohen.d(pitjungle_df_sargassum2$Amphipods,pitjungle_df_control2$Amphipods)
cohen.d(pitjungle_df_sargassum2$Arachnid,pitjungle_df_control2$Arachnid)
cohen.d(pitjungle_df_sargassum2$Hymenoptera,pitjungle_df_control2$Hymenoptera)

#subset trip 3
piteff_sub_jungle_3<-subset(piteff_sub_jungle, Trip == "3")

# Subset the data for 'Sargassum' and 'Control' treatments
pitjungle_df_sargassum3 <- piteff_sub_jungle_3[piteff_sub_jungle_3$Treatment == "Sargassum", ]
pitjungle_df_control3 <- piteff_sub_jungle_3[piteff_sub_jungle_3$Treatment == "Control", ]

### effect sizes for trip 3
cohen.d(pitjungle_df_sargassum3$Amphipods,pitjungle_df_control3$Amphipods)
cohen.d(pitjungle_df_sargassum3$Arachnid,pitjungle_df_control3$Arachnid)
cohen.d(pitjungle_df_sargassum3$Hymenoptera,pitjungle_df_control3$Hymenoptera)



#####Effect sizes#####
#I manually input the effect sizes, lower and upper limits to a file called pitfalls_effsize.csv
pitfallseffsize <-read.csv("pitfalls_effsize.csv",header=T)


sticky_eff_plot <- ggplot(pitfallseffsize) +
  aes(x = Trip, y = Effect_size, shape = Order) +
  geom_jitter(size = 1.2) +
  labs(y = "Effect size ", shape = "Taxa") +
  theme_bw() +
  facet_wrap(vars(Site), ncol = 2L)

sticky_eff_plot




```

##sticky traps

```{r}

stickies <-read.csv("stickies.csv",header=T)
#load data
stickies <-read.csv("Stickies.csv",header=T)
stickies_long<- stickies %>%
  gather(key = "Taxa", value = "Count", c(9,16,15))
stickies_long$Trip<-as.factor(stickies_long$Trip)

#fix names and calculate Mean and SE

stickies_data <- stickies_long %>%
  mutate(
    Site = ifelse(Site == "Dune", "Beach", ifelse(Site == "Jungle", "Forest", Site)),
    Trip = case_when(
      Trip == 1 ~ "Aug. 22",
      Trip == 2 ~ "Nov. 22",
      Trip == 3 ~ "Mar. 23",
      TRUE ~ as.character(Trip)  
    ),
    Treatment = case_when(
      Treatment == "Control" ~ "control",
      Treatment == "Sargassum" ~ "sargasso",
      TRUE ~ as.character(Treatment)  
    )
  ) %>%
  group_by(Site, Trip, Treatment, Taxa) %>%
  summarize(
    Mean = round(mean(Count), digits = 2), 
    SE = round(sd(Count) / sqrt(n()), digits = 2)  
  )

view(stickies_data)

#make data wide by "Site"
stic_wide_data <- stickies_data %>%
  pivot_wider(
    id_cols = c("Trip", "Treatment", "Taxa"),
    names_from = Site,
    values_from = c(Mean, SE),
    names_glue = "{Site}_{.value}")

View(stic_wide_data)


#make wider by Trip
stic_wide_data2 <- stic_wide_data %>%
  pivot_wider(
    id_cols = c( "Treatment", "Taxa"),
    names_from = Trip,
    values_from = c(Beach_Mean, Beach_SE,
    Forest_Mean, Forest_SE),
    names_glue = "{Trip}_{.value}" )

view(stic_wide_data2)

#make sure Means are next to related SEs
stic_wide_data3 <- stic_wide_data2 %>%
  select(
    # List the columns in order
    "Taxa", "Treatment",
    "Aug. 22_Beach_Mean", "Aug. 22_Beach_SE",
    "Nov. 22_Beach_Mean", "Nov. 22_Beach_SE",
    "Mar. 23_Beach_Mean", "Mar. 23_Beach_SE",
    "Aug. 22_Forest_Mean", "Aug. 22_Forest_SE",
    "Nov. 22_Forest_Mean", "Nov. 22_Forest_SE",
    "Mar. 23_Forest_Mean", "Mar. 23_Forest_SE",)

View(stic_wide_data3)

# Rename the orders in Taxa
stic_wide_data3 <- stic_wide_data3 %>%
  mutate(
    Taxa = case_when(
      Taxa == "Amphipods" ~ "Amphipoda",
      Taxa == "Diptera" ~ "Diptera",
      Taxa == "Hymenoptera" ~ "Hymenoptera",
      TRUE ~ Taxa  
    )
  )
#order by Taxa
stic_wide_data3 <- stic_wide_data3 %>%
  arrange(Taxa)

#Rename columns to just show Mean and SE
### !!!!important!!!! notice i staggered spaces in the name so that i can use the same column names for all Means and SEs
stic_wide_data4 <- stic_wide_data3 %>%
  rename(
     "Mean" = "Aug. 22_Beach_Mean", "SE   " = "Aug. 22_Beach_SE",
     " Mean" = "Nov. 22_Beach_Mean", "SE  " = "Nov. 22_Beach_SE",
     "  Mean" = "Mar. 23_Beach_Mean", "SE " = "Mar. 23_Beach_SE",
     "Mean " = "Aug. 22_Forest_Mean", "  SE"  = "Aug. 22_Forest_SE",
     "Mean  " = "Nov. 22_Forest_Mean", " SE" = "Nov. 22_Forest_SE",
     "Mean   " = "Mar. 23_Forest_Mean", "SE" = "Mar. 23_Forest_SE")


kbl(stic_wide_data4) %>%
  kable_classic("striped", full_width = T)%>%
  add_header_above(c(" " = 2, "Aug. 22" = 2, "Nov. 22" = 2, "Mar. 23" = 2, "Aug. 22" = 2, "Nov. 22" = 2, "Mar. 23" = 2)) %>%
  add_header_above(c(" " = 2, "Beach" = 6, "Forest" = 6)) 




```


### sticky trap analysis

```{r}


stickiesmod1 <-read.csv("stickies.csv",header=T)

############################################dunes############################################
#subset out the dunes
eff_sub_dune<-subset(stickiesmod1, Site == "Dune")

#subset trip 1
eff_sub_dune_1<-subset(eff_sub_dune, Trip == "1")

# Subset the data for 'Sargassum' and 'Control' treatments
dune_df_sargassum <- eff_sub_dune_1[eff_sub_dune_1$Treatment == "Sargassum", ]
dune_df_control <- eff_sub_dune_1[eff_sub_dune_1$Treatment == "Control", ]

### effect sizes for trip 1
cohen.d(dune_df_sargassum$Amphipods,dune_df_control$Amphipods)
cohen.d(dune_df_sargassum$Diptera,dune_df_control$Diptera)
cohen.d(dune_df_sargassum$Hymenoptera,dune_df_control$Hymenoptera)

#subset trip 2
eff_sub_dune_2<-subset(eff_sub_dune, Trip == "2")

# Subset the data for 'Sargassum' and 'Control' treatments
dune_df_sargassum2 <- eff_sub_dune_2[eff_sub_dune_2$Treatment == "Sargassum", ]
dune_df_control2 <- eff_sub_dune_2[eff_sub_dune_2$Treatment == "Control", ]

### effect sizes for trip 2
cohen.d(dune_df_sargassum2$Amphipods,dune_df_control2$Amphipods)
cohen.d(dune_df_sargassum2$Diptera,dune_df_control2$Diptera)
cohen.d(dune_df_sargassum2$Hymenoptera,dune_df_control2$Hymenoptera)

#subset trip 3
eff_sub_dune_3<-subset(eff_sub_dune, Trip == "3")

# Subset the data for 'Sargassum' and 'Control' treatments
dune_df_sargassum3 <- eff_sub_dune_3[eff_sub_dune_3$Treatment == "Sargassum", ]
dune_df_control3 <- eff_sub_dune_3[eff_sub_dune_3$Treatment == "Control", ]

### effect sizes for trip 3
cohen.d(dune_df_sargassum3$Amphipods,dune_df_control3$Amphipods)
cohen.d(dune_df_sargassum3$Diptera,dune_df_control3$Diptera)
cohen.d(dune_df_sargassum3$Hymenoptera,dune_df_control3$Hymenoptera)


############################################jungle############################################
#subset out the dunes
eff_sub_jungle<-subset(stickiesmod1, Site == "Jungle")

#subset trip 1
eff_sub_jungle_1<-subset(eff_sub_jungle, Trip == "1")

# Subset the data for 'Sargassum' and 'Control' treatments
jungle_df_sargassum <- eff_sub_jungle_1[eff_sub_jungle_1$Treatment == "Sargassum", ]
jungle_df_control <- eff_sub_jungle_1[eff_sub_jungle_1$Treatment == "Control", ]

### effect sizes for trip 1
cohen.d(jungle_df_sargassum$Amphipods,jungle_df_control$Amphipods)
cohen.d(jungle_df_sargassum$Diptera,jungle_df_control$Diptera)
cohen.d(jungle_df_sargassum$Hymenoptera,jungle_df_control$Hymenoptera)

#subset trip 2
eff_sub_jungle_2<-subset(eff_sub_jungle, Trip == "2")

# Subset the data for 'Sargassum' and 'Control' treatments
jungle_df_sargassum2 <- eff_sub_jungle_2[eff_sub_jungle_2$Treatment == "Sargassum", ]
jungle_df_control2 <- eff_sub_jungle_2[eff_sub_jungle_2$Treatment == "Control", ]

### effect sizes for trip 2
cohen.d(jungle_df_sargassum2$Amphipods,jungle_df_control2$Amphipods)
cohen.d(jungle_df_sargassum2$Diptera,jungle_df_control2$Diptera)
cohen.d(jungle_df_sargassum2$Hymenoptera,jungle_df_control2$Hymenoptera)

#subset trip 3
eff_sub_jungle_3<-subset(eff_sub_jungle, Trip == "3")

# Subset the data for 'Sargassum' and 'Control' treatments
jungle_df_sargassum3 <- eff_sub_jungle_3[eff_sub_jungle_3$Treatment == "Sargassum", ]
jungle_df_control3 <- eff_sub_jungle_3[eff_sub_jungle_3$Treatment == "Control", ]

### effect sizes for trip 3
cohen.d(jungle_df_sargassum3$Amphipods,jungle_df_control3$Amphipods)
cohen.d(jungle_df_sargassum3$Diptera,jungle_df_control3$Diptera)
cohen.d(jungle_df_sargassum3$Hymenoptera,jungle_df_control3$Hymenoptera)

#####Effect sizes Graph#####
#I manually input the effect sizes, lower and upper limits to a file called stickies_effsize.csv
stickieseffsize <-read.csv("sticky_effsize.csv",header=T)

stickieseffsize$Trip<-as.factor(stickieseffsize$Trip)



sticky_eff_plot <- ggplot(stickieseffsize, aes(x = Trip, y = Effect_size, shape = Order)) +
  labs(y = "Effect size", shape = "Taxa", title = "Aerial traps") +
  geom_path(aes(group = Order), position = position_dodge(0.5), color = "dark gray") +
  theme_bw() +
  facet_wrap(vars(Site), ncol = 2L, labeller = as_labeller(c("Dune" = "Beach", "Jungle" = "Forest"))) +
     geom_point(color = "black", size = 3, position = position_dodge(0.5)) +
    scale_x_discrete(
    limits = c("1", "2", "3"),
    labels = c("1" = "", "2" = "", "3" = "") ) +
  theme(
    axis.text = element_text(size=12),
    axis.title = element_text(size=12),
    plot.title = element_text(size=12),
    axis.text.x = element_text(size=12),
    strip.text = element_text(size=12)) +
   xlab("") 
#geom_pointrange(aes(ymin = lower_ci, ymax = upper_ci), position = position_dodge(0.5), color = " gray") +

sticky_eff_plot


```



#Chemicals and gases
## quick nutrients

```{r}

##quick nutrients

chemicals<-read.csv("Soil_Chemicals2.csv",header=T)

#subset experiment
SM_chem_sub<-subset(chemicals, Exp == "Sargasso Manipulation")
SG_chem<-subset(SM_chem_sub, Type == "Sargassum")
pile_chem<-subset(SG_chem, Trt == "Sediment")
pile_chem$Block<-as.factor(pile_chem$Block)
pile_chem$Trip<-as.factor(pile_chem$Trip)
pile_chem$pH<-as.numeric(pile_chem$pH)
pile_chem$KH<-as.numeric(pile_chem$KH)


#explore
#nitrate by block at beach and forest for 4 trips
ggplot(pile_chem) +
  aes(x = Site, y = Nitrate, fill = Block) +
  geom_boxplot() +
  scale_fill_hue(direction = 1) +
  theme_minimal() +
  facet_grid(vars(Trip), vars())




#sargasso treatment. It is way too convoluted and impossible t read this way
pile_chem %>%
 filter(Type %in% "Sargassum") %>%
 ggplot() +
 aes(x = Site, y = Nitrate, fill = Trt, colour = Block) +
 geom_boxplot() +
 scale_fill_hue(direction = 1) +
 scale_color_hue(direction = 1) +
 theme_minimal() +
 facet_grid(vars(Trip), vars())


# We are interested in the sediment nutrients rather than sediment and seaweed

pile_chem %>%
  filter(Type %in% "Sargassum") %>%
  filter(Trt %in% "Sediment") %>%
  group_by(Trip, Site) %>%
  summarize(mean_Nitrate = mean(Nitrate), se = sd(Nitrate) / sqrt(n())) %>%
  ggplot() +
  aes(x = Trip, y = mean_Nitrate, fill = Site) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_errorbar(aes(ymin = mean_Nitrate - se, ymax = mean_Nitrate + se), 
                position = position_dodge(width = 0.9), width = 0.25) +
  scale_fill_hue(direction = 1) +
    scale_x_discrete(
    limits = c("1", "2", "3", "4"),
    labels = c("1" = "Aug. 22", "2" = "Nov. 22", "3" = "Mar. 23", "4" = "Aug. 2024") ) +
  labs(
    x = " ",
    y = "Nitrate content (mg/L)",
    title = "",
    fill = "Sample"
  ) +
  theme_minimal()  +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines"))


```

##nitrogen
```{r}
nitrogen<-read.csv("sargasso_nitrates.csv",header=T)

nitrogen$block<-as.factor(nitrogen$block)
nitrogen$trip<-as.factor(nitrogen$trip)

nitrogen %>%
 filter(!(site %in% "")) %>%
 filter(!(treatment %in% "")) %>%
  group_by(trip, site, treatment) %>%
  summarize(mean_N = mean(N), N_se = sd(N) / sqrt(n())) %>%
  ggplot() +
  aes(x =trip, y = mean_N, fill = treatment) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_errorbar(aes(ymin = mean_N - N_se, ymax = mean_N + N_se), 
                position = position_dodge(width = 0.9), width = 0.25) +
  scale_fill_hue(direction = 1) +
    scale_x_discrete(
    limits = c("1", "2", "3", "4"),
    labels = c("1" = "Aug. 22", "2" = "Nov. 22", "3" = "Mar. 23", "4" = "Aug. 2024") ) +
  labs(
    x = " ",
    y = "Nitrogen in sediment (ugN/g)",
    title = ""
  ) +
  theme_classic()  +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines")) +
    facet_grid(vars(), vars(site),scales = "fixed")

```


##gasses
```{r}
CO2<-read.csv("gas_readings.csv",header=T)

#subset experiment
gas_CO2<-subset(CO2, !Treatment == "na")
gas_CO2$CO2<-as.numeric(gas_CO2$CO2)
gas_CO2$Trip<-is.factor(gas_CO2$CO2)

#gas collectors
gas_CO2 %>%
  filter(Experiment %in% "collectors") %>%
  filter(Time %in% "T1") %>%
  ggplot() +
  aes(x = Treatment, y = CO2, fill = Time) +
  stat_summary(
    fun = "mean",
    geom = "bar",
    position = "dodge",
    width = 0.7
  ) +
  stat_summary(
    fun.data = mean_se,
    geom = "errorbar",
    position = position_dodge(width = 0.7),
    width = 0.25
  ) +
  scale_fill_hue(direction = 1) +
  labs(
    x = " ",
    y = "Units",
    title = "Gas collector",
    fill = "Time point"
  ) +
    theme_minimal() +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines"),
    axis.title = element_text(size = 16),   # axis titles
    axis.text = element_text(size = 14),    # axis labels
    axis.text.x = element_text(size = 14),  # x-axis labels
    plot.title = element_text(size = 18),   # plot title (if needed)
    legend.title = element_text(size = 16), # legend title
    legend.text = element_text(size = 14)   # legend labels
  ) +
  facet_grid(vars(), vars(Site), scales = "free_y")


co2_data <- gas_CO2 %>%
  group_by(Site, Treatment, Time) %>%
  summarize(mean_CO2 = mean(CO2), se = sd(CO2) / sqrt(n()))
co2_data

# two-way ANOVA
CO2_anova <- aov(CO2 ~ Treatment * Site, data = gas_CO2)

summary(CO2_anova)


#################################################respirometer##################################3##

CO2<-read.csv("gas_readings.csv",header=T)

#subset experiment
respirometer<-subset(CO2, Experiment == "respirometer") 


# hree-way ANOVA
CO2_resp_anova <- aov(Carbon_dioxide ~ Treatment * Position * Site, data = respirometer)

summary(CO2_resp_anova)

#analyze separately by site
##first look at beach
resp_beach<- subset(respirometer, Site == "Beach")
# Perform the three-way ANOVA
CO2_resp_anova_Beach <- aov(Carbon_dioxide ~ Treatment * Position, data = resp_beach)

summary(CO2_resp_anova_Beach)

CO2_resp_anova_Beach_tukeys<- HSD.test(CO2_resp_anova_Beach, "Treatment")
print(CO2_resp_anova_Beach_tukeys)
plot(CO2_resp_anova_Beach_tukeys)

#lets see the means and SE
co2_data_resp <- resp_beach %>%
  group_by(Treatment, Position) %>%
  summarize(mean_CO2 = mean(Carbon_dioxide), se = sd(Carbon_dioxide) / sqrt(n()))
co2_data_resp


#now lets do it for the the forest
resp_forest<- subset(respirometer, Site == "Forest")
# Perform the three-way ANOVA
CO2_resp_anova_forest <- aov(Carbon_dioxide ~ Treatment * Position, data = resp_forest)

summary(CO2_resp_anova_forest)

CO2_resp_anova_forest_tukeys<- HSD.test(CO2_resp_anova_forest, "Treatment")
print(CO2_resp_anova_forest_tukeys)
plot(CO2_resp_anova_forest_tukeys)

#lets see the means and SE
co2_data_resp2 <- resp_forest %>%
  group_by(Treatment, Position) %>%
  summarize(mean_CO2 = mean(Carbon_dioxide), se = sd(Carbon_dioxide) / sqrt(n()))
co2_data_resp2


#graph it
gas_CO2 %>%
  filter(Experiment %in% "respirometer") %>%
  ggplot() +
  aes(x = Treatment, y = Carbon_dioxide, fill = Position) +
  stat_summary(
    fun = "mean",
    geom = "bar",
    position = "dodge",
    width = 0.7
  ) +
  stat_summary(
    fun.data = mean_se,
    geom = "errorbar",
    position = position_dodge(width = 0.7),
    width = 0.25
  ) +
  scale_fill_hue(direction = 1) +
  labs(
    x = " ",
    y = "Units",
    title = "Respirometer",
    fill = "Reader position"
  ) +
  theme_minimal() +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines"),
    axis.title = element_text(size = 16),   # axis titles
    axis.text = element_text(size = 14),    # axis labels
    axis.text.x = element_text(size = 14),  # x-axis labels
    plot.title = element_text(size = 18),   
    legend.title = element_text(size = 16), 
    legend.text = element_text(size = 14)   
  ) +
  facet_grid(vars(), vars(Site))



```


#Manuscript figures

##decomp bags
```{r}
decomp_bags<-read.csv("mesh_bag_exp.csv",header = T )
decomp_bags$Rep_no.<-as.factor(decomp_bags$Rep_no.)
decomp_bags$Trip<-as.factor(decomp_bags$Trip)

view(decomp_bags)


#quick view counts of percent
ggplot(decomp_bags) +
 aes(x = Trip, fill = Treatment, weight = prc_means) +
 geom_bar(position = "dodge") +
 scale_fill_hue(direction = 1) +
 theme_minimal() +
 facet_grid(vars(Site), vars())
##############################decomposer experiment##################################
#now lets look at mean values and SE
#subset out trip 1 since its only going to show initial mass which is 100%


decomp_bags %>%
  filter(!(Trip %in% "1")) %>%
  ggplot() +
  scale_fill_manual(name = "Mesh size", 
                    values = c("large" = "light gray", "small" = "white")) +  
  scale_color_manual(name = "Mesh size",
                     values = c("large" = "black", "small" = "black")) +  
  aes(x = Site, fill = Treatment, weight = prc_means) + 
  geom_bar(position = "dodge", color = "black") +   
  geom_errorbar(aes(ymin = prc_means - prc_SE, ymax = prc_means + prc_SE), 
                position = position_dodge(width = 0.9), 
                width = 0.25) +  
  labs(y = "Decomposition (% of initial dry biomass)", x = "") +
  theme_classic() +
  facet_grid(Trip ~ ., labeller = labeller(Trip = function(x) ifelse(x == "2", "Nov. 22", ifelse(x == "3", "Mar. 23", x)))) + 
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines"),
    axis.title = element_text(size = 16, color = "black"),   
    axis.text = element_text(size = 14, color = "black"),     
    axis.text.x = element_text(size = 14, color = "black"),   
    plot.title = element_text(size = 18, color = "black"),   
    legend.title = element_text(size = 16, color = "black"), 
    legend.text = element_text(size = 14, color = "black"),
    legend.position = "bottom",
    strip.text = element_text(size = 16, color = "black"),  
    plot.background = element_rect(fill = "white"))  



```


##decomp inverts
```{r}
decomp<-read.csv("mesh_bag_inverts.csv",header = T )
decomp$Rep_no.<-as.factor(decomp$Rep_no.)
decomp$Trip<-as.factor(decomp$Trip)

view(decomp)

decomp_inverts<- decomp %>%
  gather(key = "inverts", value = "count", c(5,6,11))

#remove small bags 
decomp_inverts2<-subset(decomp_inverts, Treatment == "large")


invert_plot <- ggplot(data = decomp_inverts2,
                      aes(
                        x = inverts,
                        y = count,
                      )) +
  stat_summary(geom = "bar", fun = mean, position = position_dodge(width = 1),
               size = 2L, stroke = 1) +
  stat_summary(geom = "errorbar", fun.data = mean_se, position = position_dodge(width = 1),
               width = 0.2) +  
  theme_classic() +
  facet_grid(vars(Trip), vars(Site)) +
   theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines"),
    text = element_text(size = 14, color = "black"),
    axis.title = element_text(size = 16, color = "black"),
    axis.text = element_text(size = 14, color = "black"),
    axis.text.x = element_text(size = 14, color = "black"),
    plot.title = element_text(size = 12, color = "black"),
    legend.title = element_text(size = 16, color = "black"),
    legend.text = element_text(size = 14, color = "black"),
    strip.text = element_text(size = 14, color = "black")) +  
  labs(y = "Arthroopod counts", x = "", title = "Mesh bag inverts")

invert_plot

```

##chemistry
```{r}



#ammonium
ammonium<-read.csv("sargasso_nitrates.csv",header=T)

ammonium$block<-as.factor(ammonium$block)
ammonium$trip<-as.factor(ammonium$trip)

NH4<-ammonium %>%
 filter(!(site %in% "")) %>%
 filter(!(treatment %in% "")) %>%
  group_by(trip, site, treatment) %>%
  summarize(mean_NH4 = mean(NH4), NH4_se = sd(NH4) / sqrt(n())) %>%
  ggplot() +
  aes(x =trip, y = mean_NH4, fill = treatment) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_errorbar(aes(ymin = mean_NH4 - NH4_se, ymax = mean_NH4 + NH4_se), 
                position = position_dodge(width = 0.9), width = 0.25) +
   scale_fill_manual(values = c("lightgray", "dark gray")) +
    scale_x_discrete(
    limits = c("1", "2", "3", "4"),
    labels = c("1" = "Aug. 22", "2" = "Nov. 22", "3" = "Mar. 23", "4" = "Aug. 2024") ) +
  labs(
    x = " ",
    y = expression("Ammonium (mg) sediment (kg"^{-1} * ")"),
    title = "",
    fill = "Treatment") +
  theme_classic()  +
   theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines"),
   axis.title = element_text(size = 14, color = "black"),   
    axis.text = element_text(size = 12, color = "black"),     
    axis.text.x = element_text(size = 12, color = "black"),   
    plot.title = element_text(size = 16, color = "black"),   
    legend.title = element_text(size = 14, color = "black"), 
    legend.text = element_text(size = 12, color = "black"), 
   strip.text = element_text(size = 14, color = "black"), 
    legend.position = "",
     legend.box = "horizontal",
    plot.background = element_rect(fill = "white"))  +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines")) +
    facet_grid(vars(), vars(site),scales = "fixed")

NH4

#nitrate
nitrogen<-read.csv("sargasso_nitrates.csv",header=T)

nitrogen$block<-as.factor(nitrogen$block)
nitrogen$trip<-as.factor(nitrogen$trip)

N <- nitrogen %>%
  filter(!(site %in% "")) %>%
  filter(!(treatment %in% "")) %>%
  group_by(trip, site, treatment) %>%
  summarize(mean_N = mean(N), N_se = sd(N) / sqrt(n())) %>%
  ggplot() +
  aes(x = trip, y = mean_N, fill = treatment) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_errorbar(aes(ymin = mean_N - N_se, ymax = mean_N + N_se), 
                position = position_dodge(width = 0.9), width = 0.25) +
  scale_fill_manual(values = c("lightgray", "dark gray")) +
  scale_x_discrete(
    limits = c("1", "2", "3", "4"),
    labels = c("1" = "Aug. 22", "2" = "Nov. 22", "3" = "Mar. 23", "4" = "Aug. 2024")) +
  labs(
    x = " ",
    y = expression("Nitrate (mg) sediment (kg"^{-1} * ")"),
    title = "",
    fill = "Treatment") +
  theme_classic() +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines"),
   axis.title = element_text(size = 14, color = "black"),   
    axis.text = element_text(size = 12, color = "black"),     
    axis.text.x = element_text(size = 12, color = "black"),   
    plot.title = element_text(size = 16, color = "black"),   
    legend.title = element_text(size = 14, color = "black"), 
    legend.text = element_text(size = 12, color = "black"), 
   strip.text = element_text(size = 14, color = "black"), 
      strip.text.x = element_blank(), 
    legend.position = "",
    legend.box = "horizontal",
    plot.background = element_rect(fill = "white")) +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines")) +
  facet_grid(vars(), vars(site), scales = "fixed")
  
print(N)


#carbon
carbon<-read.csv("sargasso_nitrates.csv",header=T)

carbon$block<-as.factor(carbon$block)
carbon$trip<-as.factor(carbon$trip)

C<-carbon %>%
 filter(!(site %in% "")) %>%
 filter(!(treatment %in% "")) %>%
  group_by(trip, site, treatment) %>%
  summarize(mean_C = mean(C), C_se = sd(C) / sqrt(n())) %>%
  ggplot() +
  aes(x =trip, y = mean_C, fill = treatment) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_errorbar(aes(ymin = mean_C - C_se, ymax = mean_C + C_se), 
                position = position_dodge(width = 0.9), width = 0.25) +
   scale_fill_manual(values = c("lightgray", "dark gray")) +
    scale_x_discrete(
    limits = c("1", "2", "3", "4"),
    labels = c("1" = "Aug. 22", "2" = "Nov. 22", "3" = "Mar. 23", "4" = "Aug. 2024") ) +
  labs(
    x = " ",
    y = expression("DOC (mg) sediment (kg"^{-1} * ")"),
    title = "",
    fill = "Treatment") +
  theme_classic()  +
   theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines"),
   axis.title = element_text(size = 14, color = "black"),   
    axis.text = element_text(size = 12, color = "black"),     
    axis.text.x = element_text(size = 12, color = "black"),   
    plot.title = element_text(size = 16, color = "black"),   
    legend.title = element_text(size = 14, color = "black"), 
    legend.text = element_text(size = 12, color = "black"), 
   strip.text = element_text(size = 14, color = "black"), 
     strip.text.x = element_blank(), 
    legend.position = "bottom",
     legend.box = "horizontal",
    plot.background = element_rect(fill = "white"))  +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines")) +
    facet_grid(vars(), vars(site),scales = "fixed")

C


# Stack the plots vertically
stacked_plots <- NH4 / N / C

# Display the stacked plots
stacked_plots


```

##CO2
```{r}
##############################gases#################################################
#gas collectors

CO2<-read.csv("gas_readings.csv",header=T)

#subset experiment
collectors<-subset(CO2, Experiment == "collectors") 
collectors<-subset(collectors, !Site == "Calibrate")
collectors<-subset(collectors, !Time == "T0")


CO2plot1 <- collectors %>%
  group_by(Site, Treatment, Time) %>%
  summarize(mean_CO2 = mean(CO2), se = sd(CO2) / sqrt(n())) %>%
  ggplot() +
  aes(x = Treatment, y = mean_CO2) +  
  geom_bar(stat = "identity", position = "dodge", color = "black") +
  geom_errorbar(aes(ymin = mean_CO2 - se, ymax = mean_CO2 + se), 
                position = position_dodge(width = 0.9), width = 0.25) +
  labs(
    x = " ",
    y = "gCO2/m2/h",
    title = "Gas collectors",
    fill = "Sample"
  ) +
  theme_classic() +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines"),
   axis.title = element_text(size = 16, color = "black"),   
    axis.text = element_text(size = 14, color = "black"),     
    axis.text.x = element_text(size = 14, color = "black"),   
    plot.title = element_text(size = 18, color = "black"),   
    legend.title = element_text(size = 16, color = "black"), 
    legend.text = element_text(size = 14, color = "black"), 
   strip.text = element_text(size = 16, color = "black"),  
    plot.background = element_rect(fill = "white"))  +
  scale_x_discrete(labels = c("control", "sargasso")) +
  facet_grid(vars(), vars(Site), scales = "fixed")


CO2plot1

CO2plot1 <- CO2plot1 +
  theme(
    axis.title.y = element_text(margin = margin(r = 0)),   
  )




#################################3respirometer##########################3

CO2<-read.csv("gas_readings.csv",header=T)


#subset experiment
respirometer<-subset(CO2, Experiment == "respirometer") 

CO2plot2 <- respirometer %>%
  group_by(Site, Treatment, Position) %>%
  summarize(mean_CO2 = mean(Carbon_dioxide), se = sd(Carbon_dioxide) / sqrt(n())) %>%
  ggplot() +
  aes(x = Treatment, y = mean_CO2, fill = Position) +
  geom_bar(stat = "identity", position = "dodge", color = "black") +
  geom_errorbar(aes(ymin = mean_CO2 - se, ymax = mean_CO2 + se), 
                position = position_dodge(width = 0.9), width = 0.25) +
  scale_fill_manual(values = c("lightgray", "white")) +
  labs(
    x = " ",
    y = "CO2 UNITS",
    title = "Respirometer",
    fill = "Position"
  ) +
  theme_classic() +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines"),
    axis.title = element_text(size = 16, color = "black"),   
    axis.text = element_text(size = 14, color = "black"),     
    axis.text.x = element_text(size = 14, color = "black"),   
    plot.title = element_text(size = 18, color = "black"),   
    legend.title = element_text(size = 16, color = "black"), 
    legend.text = element_text(size = 14, color = "black"),
    legend.position = "bottom",
     legend.box = "horizontal",
    strip.text = element_text(size = 16, color = "black"),  
    plot.background = element_rect(fill = "white"))  +
  facet_grid(vars(), vars(Site), scales = "fixed") +
  scale_x_discrete(labels = c("control", "sargasso"))  


CO2plot2 <- CO2plot2 +
  theme(
    axis.title.y = element_text(margin = margin(r = )), )

CO2plot2


combined_CO2 <- grid.arrange(CO2plot1, CO2plot2)

```

##interior percent cover
```{r}
#import dataset
interiorrsurvey<-read.csv("interior_survey.csv", header = TRUE)

interior_survey_long<- interiorsurvey %>%
  gather(key = "cover_type", value = "percent_cover", c(57,60))
interior_survey_long$Trip<-as.factor(interior_survey_long$Trip)


##############################interior percent cover##################################
interior_pc_cover <- ggplot(data = interior_survey_long,
            aes(
              x = Trip,
              y = percent_cover,
              shape = cover_type,
              color = Treatment
            )) +
  stat_summary(geom = "point", fun = mean, position = position_dodge(width = 1),
               size = 2L, stroke = 1) +
  stat_summary(geom = "errorbar", fun.data = mean_se, position = position_dodge(width = 1),
               width = 0.2) +   
  labs(
    x = " ",
    y = "Mean percent cover",
    title = "Interior mean percent cover"
  ) +
  scale_x_discrete(
    limits = c("1", "2", "3", "4"),
    labels = c("1" = "Aug. 22", "2" = "Nov. 22", "3" = "Mar. 23", "4" = "Aug. 23")
  ) +
  facet_grid(vars(), vars(Site), labeller = labeller(Site = c(Dunes = "Beach", Jungle = "Forest"))) +   
  theme_classic() +
  scale_fill_manual(values = c("grey44", "black")) +
  scale_color_manual(values = c("grey44", "black")) +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines"),
    text = element_text(size = 16),
    axis.title = element_text(size = 16, margin = margin(t = 0, r = 10, b = 0, l = 0)),  
    axis.text = element_text(size = 14),
    axis.text.x = element_text(size = 0),
    plot.title = element_text(size = 14),
    legend.title = element_text(size = 14),  
    legend.text = element_text(size = 14) ) +
  scale_shape_manual(
    values = c("circle",  "triangle"),
    labels = c("grass", "other plants")  ) +
  labs(shape = "Cover type")   
  

interior_pc_cover




#effect size graph

interioreffsize1 <-read.csv("interior_graphs.csv",header=T)
interioreffsize <-subset(interioreffsize1, Data == "eff_size")

interioreffsize<-subset(interioreffsize, !Cover == "all_plants")
interioreffsize<-subset(interioreffsize, !Cover ==  "bare" ) 
interioreffsize<-subset(interioreffsize, !Cover == "leaf_litter")
interioreffsize$Trip<-as.factor(interioreffsize$Trip)
interioreffsize$Effect_size<-as.numeric(interioreffsize$Effect_size)


#interior effect size graph
int_eff_plot <- ggplot(interioreffsize, aes(x = Trip, y = Effect_size, shape = Cover)) +
  labs(y = "Effect size", title = "") +
  geom_path(aes(group = Cover), position = position_dodge(0.5), color = "dark gray") +
  theme_classic() +
  facet_wrap(vars(Site), ncol = 2L) +
  geom_point(color = "black", size = 3, position = position_dodge(0.5)) +
  scale_x_discrete(
    limits = c("1", "2", "3", "4"),
    labels = c("1" = "Aug. 22", "2" = "Nov. 22", "3" = "Mar. 23", "4" = "Aug. 23")
  ) +
    scale_shape_discrete(labels = c("grass", "other plants")) +
 theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines"),
    text = element_text(size = 14),
    axis.title = element_text(size = 16),
    axis.text = element_text(size = 14),
    axis.text.x = element_text(size = 14),
    plot.title = element_text(size = 12),
    legend.title = element_text(size = 0),
    legend.text = element_text(size = 16),
    strip.text = element_blank() ) +
  xlab("") 

int_eff_plot

#combine 
combined_int_effgraphs <- grid.arrange(interior_pc_cover, int_eff_plot, ncol = 1)

```

##perimeter percent cover
```{r}

perimetersurvey<-read.csv("perimeter_survey.csv", header = TRUE)

perimetersurvey$Treatment<-as.factor(perimetersurvey$Treatment)
perimetersurvey$Block<-as.factor(perimetersurvey$Block)
perimetersurvey$Trip<-as.factor(perimetersurvey$Trip)

view(perimeter_short)
perimeter_short <- subset(perimeter_survey_long, !(Trip %in% c("2", "3")))

#################################perimeter percent cover#########################
perimeter_pc_cover<-ggplot(data = perimeter_short,
       aes(
         x = Trip,
         y = percent_cover,
         shape = cover_type,
         color = Treatment
       )) +
  stat_summary(geom = "point", fun = mean, position = position_dodge(width = 1),
               size = 2L, stroke = 1) +
  stat_summary(geom = "errorbar", fun.data = mean_se, position = position_dodge(width = 1),
               width = 0.2) +
  labs(
    x = " ",
    y = "Mean percent cover",
    title = "Perimeter mean percent cover"
  ) +
  scale_x_discrete(
    limits = c("1", "4"),
    labels = c("1" = "Aug. 22", "4" = "Aug. 23")
  ) +
   facet_grid(vars(), vars(Site), labeller = labeller(Site = c(Dunes = "Beach", Jungle = "Forest"))) +   
  theme_classic() +
  scale_fill_manual(values = c("grey44", "black")) +
  scale_color_manual(values = c("grey44", "black")) +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines"),
    text = element_text(size = 16),
    axis.title = element_text(size = 16, margin = margin(t = 0, r = 10, b = 0, l = 0)),  
    axis.text = element_text(size = 14),
    axis.text.x = element_text(size = 0),
    plot.title = element_text(size = 14),
    legend.title = element_text(size = 14),  
    legend.text = element_text(size = 14) ) +
  scale_shape_manual(
    values = c("circle",  "triangle"),
    labels = c("grass", "other plants")  ) +
  labs(shape = "Cover type")   


perimeter_pc_cover


#############################################3eff sizes###############################

perimetereffsize1 <-read.csv("perimeter_graphs.csv",header=T)
perimetereffsize <-subset(perimetereffsize1, Data == "eff_size")

perimetereffsize<-subset(perimetereffsize, !Cover == "all_plants")
perimetereffsize<-subset(perimetereffsize, !Cover ==  "dead" ) 
perimetereffsize<-subset(perimetereffsize, !Cover ==  "bare" ) 
perimetereffsize$Trip<-as.factor(perimetereffsize$Trip)
perimetereffsize$Effect_size<-as.numeric(perimetereffsize$Effect_size)

perimeter_short_effsize <- subset(perimetereffsize, !(Trip %in% c("2", "3")))

per_eff_plot <- ggplot(perimeter_short_effsize, aes(x = Trip, y = Effect_size, shape = Cover)) +
  labs(y = "Effect size", title = "") +
  geom_path(aes(group = Cover), position = position_dodge(0.5), color = "dark gray") +
  theme_classic() +
  facet_wrap(vars(Site), ncol = 2L) +
  geom_point(color = "black", size = 3, position = position_dodge(0.5)) +
  scale_x_discrete(
    limits = c("1", "4"),
    labels = c("1" = "Aug. 22", "4" = "Aug. 23")
  ) +
  scale_shape_discrete(labels = c("grass", "other plants")) +
 theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines"),
    text = element_text(size = 14),
    axis.title = element_text(size = 16),
    axis.text = element_text(size = 14),
    axis.text.x = element_text(size = 14),
    plot.title = element_text(size = 12),
    legend.title = element_text(size = 0),
    legend.text = element_text(size = 16),
    strip.text = element_blank() ) +
  xlab("") 
per_eff_plot

#combine 
combined_perimeter_graph<- grid.arrange(perimeter_pc_cover, per_eff_plot, ncol = 1)

```

##distance effect
```{r}
dist<-read.csv("ladder.csv",header=T)
view(dist)
dist$trip<-is.facet(dist$trip)

#make data long 
laddersurvey_long <- gather(ladder, key = "cover_type", value = "percent_cover", 16:17, -c(1:5),) 

```

##arthropods
###crawling
```{r}


##################################arthropods##########################

#pitfalls
#load data
pitfalls <-read.csv("Pitfalls.csv",header=T)
pitfalls_long<- pitfalls %>%
  gather(key = "Taxa", value = "Count", c(8,13,15))
pitfalls_long$Trip<-as.factor(pitfalls_long$Trip)


# Calculate means and standard errors for each combination of Trip, Taxa, and Treatment
pitfalls_data <- pitfalls_long %>%
  group_by(Site, Trip, Treatment, Taxa) %>%
  summarize(mean_count = mean(Count), 
            std_error = sd(Count) / sqrt(n()))

pitfall_count <- ggplot(pitfalls_data) +
  aes(x = Trip, y = mean_count, shape = Taxa) + 
  geom_jitter(position = position_dodge(width = 0.5), size = 2, alpha = 0.7) +   
  geom_errorbar(aes(ymin = mean_count - std_error, ymax = mean_count + std_error),
                position = position_dodge(width = 0.5), width = 0.2) +  
  theme_minimal() +
  scale_x_discrete(
    limits = c("1", "2", "3"),
    labels = c("1" = "Aug. 22", "2" = "Nov. 22", "3" = "Mar. 23")) +
  theme_classic() +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines"),
    text = element_text(size = 14),
    axis.title = element_text(size = 16),
    axis.text = element_text(size = 14),
    axis.text.x = element_text(size = 16),
    plot.title = element_text(size = 12),
    legend.title = element_text(size = 16),
    legend.text = element_text(size = 14),
    legend.position = ""
  ) +
  xlab("") +
  ylab("Crawling arthropod abundance") +
  facet_grid(vars(Site), vars(Treatment), scales = "free_y", 
             labeller = labeller(Treatment = c(Control = "Control", Sargassum = "Sargassum"),
                                 Site = c(Dune = "Beach", Jungle = "Forest"))) +
  theme(strip.text = element_text(size = 16)) +
  labs(title = "") +
  labs(subtitle = "") +
  labs(caption = "") +
  theme(plot.title = element_text(size = 16))

print(pitfall_count)




#####Effect sizes Graph#####
#I manually input the effect sizes, lower and upper limits to a file called pitfall_effsize.csv
pitfalleffsize <-read.csv("pitfalls_effsize.csv",header=T)

pitfalleffsize$Trip<-as.factor(pitfalleffsize$Trip)

pitfall_eff_plot <- ggplot(pitfalleffsize, aes(x = Trip, y = Effect_size, shape = Order)) +
  labs(y = "Effect size", shape = "Taxa") +
  geom_path(aes(group = Order), position = position_dodge(0.5), color = "dark gray") +
  theme_classic() +
  facet_wrap(vars(Site), ncol = 2L, labeller = as_labeller(c("Dune" = "Beach", "Jungle" = "Forest"))) +
  geom_point(color = "black", size = 3, position = position_dodge(0.5)) +
  scale_x_discrete(
    limits = c("1", "2", "3"),
    labels = c("1" = "Aug. 22", "2" = "Nov. 22", "3" = "Mar. 23")
  ) +
  theme(
    strip.text = element_blank(),  # Add this line to remove facet labels on top
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines"),
    text = element_text(size = 14),
    axis.title = element_text(size = 16),
    axis.text = element_text(size = 14),
    axis.text.x = element_text(size = 14),
    plot.title = element_text(size = 12),
    legend.title = element_text(size = 16),
    legend.text = element_text(size = 14),
    legend.position = "bottom"
  ) +
  xlab("")


pitfall_eff_plot

combined_sticky_graphs <- grid.arrange(
  pitfall_count,
  pitfall_eff_plot,
  ncol = 1,
  heights = c(4, 2))

print(combined_sticky_graphs)

```

###flying
```{r}
####################################aerial traps#############################


#load data
stickies <-read.csv("Stickies.csv",header=T)
stickies_long<- stickies %>%
  gather(key = "Taxa", value = "Count", c(9,16,15))
stickies_long$Trip<-as.factor(stickies_long$Trip)


# Calculate means and standard errors for each combination of Trip, Taxa, and Treatment
stickies_data <- stickies_long %>%
  group_by(Trip, Site, Treatment, Taxa) %>%
  summarize(mean_count = mean(Count), 
            std_error = sd(Count) / sqrt(n()))

# Create the plot with jittered dots and error bars
stickies_prc_cover <- ggplot(stickies_data) +
  aes(x = Trip, y = mean_count, shape = Taxa) + 
  geom_jitter(position = position_dodge(width = 0.5), size = 2, alpha = 0.7) +   
  geom_errorbar(aes(ymin = mean_count - std_error, ymax = mean_count + std_error),
                position = position_dodge(width = 0.5), width = 0.2) +  
  theme_classic() +
  scale_x_discrete(
    limits = c("1", "2", "3"),
    labels = c("1" = "Aug. 22", "2" = "Nov. 22", "3" = "Mar. 23")) +
  theme_classic() +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines"),
    text = element_text(size = 14),
    axis.title = element_text(size = 16),
    axis.text = element_text(size = 14),
    axis.text.x = element_text(size = 16),
    plot.title = element_text(size = 12),
    legend.title = element_text(size = 16),
    legend.text = element_text(size = 14),
    legend.position = ""
  ) +
  xlab("") +
  ylab("Flying arthropod abundance") +
  facet_grid(vars(Site), vars(Treatment), scales = "free_y", 
             labeller = labeller(Treatment = c(Control = "Control", Sargassum = "Sargassum"),
                                 Site = c(Dune = "Beach", Jungle = "Forest"))) +
  theme(strip.text = element_text(size = 16)) +
  labs(title = "") +
  labs(subtitle = "") +
  labs(caption = "") +
  theme(plot.title = element_text(size = 16))

print(stickies_prc_cover)


#####Effect sizes Graph#####
#I manually input the effect sizes, lower and upper limits to a file called sticky_effsize.csv
stickieseffsize <-read.csv("sticky_effsize.csv",header=T)

stickieseffsize$Trip<-as.factor(stickieseffsize$Trip)


stickies_eff_plot <- ggplot(stickieseffsize, aes(x = Trip, y = Effect_size, shape = Order)) +
  labs(y = "Effect size", shape = "Taxa") +
  geom_path(aes(group = Order), position = position_dodge(0.5), color = "dark gray") +
  theme_classic() +
  facet_wrap(vars(Site), ncol = 2L, labeller = as_labeller(c("Dune" = "Beach", "Jungle" = "Forest"))) +
  geom_point(color = "black", size = 3, position = position_dodge(0.5)) +
  scale_x_discrete(
    limits = c("1", "2", "3"),
    labels = c("1" = "Aug. 22", "2" = "Nov. 22", "3" = "Mar. 23")
  ) +
theme(
    strip.text = element_blank(),  # Add this line to remove facet labels on top
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines"),
    text = element_text(size = 14),
    axis.title = element_text(size = 16),
    axis.text = element_text(size = 14),
    axis.text.x = element_text(size = 14),
    plot.title = element_text(size = 12),
    legend.title = element_text(size = 16),
    legend.text = element_text(size = 14),
    legend.position = "bottom"
  ) +
  xlab("")

stickies_eff_plot

# combine

combined_sticky_graphs <- grid.arrange(
  stickies_prc_cover,
  stickies_eff_plot,
  ncol = 1,
  heights = c(4, 2))

 
print(combined_sticky_graphs)

```

#Supplementary graphs
##pile vol
```{r}


####################may need to cut this graph for publication due to too many figures
#####################################pile volumes#####################################

piles <-read.csv("Sargassum_piles.csv",header=T)
piles2<-subset(piles, Treatment== "Sargassum")
piles2$Trip<-as.factor(piles2$Trip)
piles2$Block<-as.factor(piles2$Block)
# Calculate the means by month and location

mean_data <- piles2 %>%
  group_by(Trip, Location) %>%
  summarize(mean_ellipsoid_vol = mean(Ellipsoid_prc_D))


# Create the scatter plot with mean points connected by a line
scatterplot <- ggplot(data = piles2, aes(x = Trip, y = Ellipsoid_prc_D, fill = Location)) +
  geom_point(size = 2, shape = 21, aes(fill = Location)) +
  geom_line(data = mean_data, aes(x = Trip, y = mean_ellipsoid_vol, group = Location), color = "gray")

# Customize the plot appearance
vol_x_time <- scatterplot +
  labs(x = "", y = "Pile volume (%)") +
  scale_color_manual(values = c("black", "white")) +
  scale_fill_manual(values = c("black", "white")) +
  scale_x_discrete(
    limits = c("1", "2", "3", "4"),
    labels = c("1" = "Aug. 22", "2" = "Nov. 22", "3" = "Mar.23", "4" = "Aug.23")
  ) +
  theme_classic() +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines"),
    axis.title = element_text(size = 16, color = "black"),    
    axis.text = element_text(size = 14, color = "black"),     
    axis.text.x = element_text(size = 14, color = "black"),   
    plot.title = element_text(size = 18, color = "black"),    
    legend.title = element_text(size = 16, color = "black"),  
    legend.text = element_text(size = 14, color = "black")  )

vol_x_time
```

## full ladder survey
```{r}
ladder_survey_full <-read.csv("ladder.csv",header=T)  

ladder_survey_long<- ladder_survey_full %>%
  gather(key = "cover_type", value = "percent_cover", c(9,10))
ladder_survey_long$Trip<-as.factor(ladder_survey_long$Trip)
ladder_survey_long$Quadrat<-as.factor(ladder_survey_long$Quadrat)

ladder_survey_short1 <- subset(ladder_survey_long, !(Trip %in% c("1", "2")))
ladder_survey_short2 <- subset(ladder_survey_short1,!(Quadrat %in% c("0")))


ladder_survey_summed <- ladder_survey_short2 %>%
  group_by(Site, Trip, Quadrat, Treatment, cover_type) %>%
  summarize(mean_cover = mean(percent_cover),
            mean_se = sd(percent_cover) / sqrt(n()))


ladder_sargasso_graph <- ggplot(ladder_survey_summed) +
  aes(x = cover_type, y = mean_cover, fill = Treatment) +  
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_cover - mean_se, ymax = mean_cover + mean_se), 
                position = position_dodge(width = 0.7), width = 0.2) +
  scale_fill_manual(values = c("lightgray", "darkgray"),
                    labels = c("Control", "Sargasso")) +
  labs(
    x = "",
    y = "Percent cover",
    fill = "Treatment",
  ) +
  theme_minimal() +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines"),
    text = element_text(size = 12),
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 12),
    axis.text.x = element_text(size = 12),
    plot.title = element_text(size = 12),
    legend.title = element_text(size = 12),
    legend.text = element_text(size = 10),
    strip.text = element_text(size = 10),
    legend.position = "bottom"
  ) +
  facet_grid(vars(Quadrat), vars(Site))

print(ladder_sargasso_graph)






#make graphs for sargasso plots

ladder_long_sarg<-subset(ladder_survey_long, Treatment == "Sargassum")


ladder_sargasso <- ladder_long_sarg %>%
  group_by(Site, Trip, Quadrat, cover_type) %>%
  summarize(mean_cover = mean(percent_cover),
            mean_se = sd(percent_cover) / sqrt(n()))

ladder_sargasso_graph <- ggplot(ladder_sargasso) +
  aes(x = Trip, y = mean_cover, fill = cover_type) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_cover - mean_se, ymax = mean_cover + mean_se), 
                position = position_dodge(width = 0.7), width = 0.2) +
  scale_fill_manual(values = c("lightgray", "darkgray"),
                    labels = c("grass", "other plants")) +
  labs(
    x = "",
    y = "Percent cover",
    fill = "Cover type",
    title = "Sargasso plots"
  ) +
  scale_x_discrete(
    limits = c("1", "2", "3"),
    labels = c("1" = "Aug. 22", "2" = "Nov. 22", "3" = "Mar. 23")
  ) +
  theme_minimal() +
 theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines"),
    text = element_text(size = 12),
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 12),
    axis.text.x = element_text(size = 12),
    plot.title = element_text(size = 12),
    legend.title = element_text(size = 12),
    legend.text = element_text(size = 10),
    strip.text = element_text(size = 10),  
    legend.position = "bottom"
  ) +
  facet_grid(vars(Quadrat), vars(Site))

print(ladder_sargasso_graph)


#make graphs for control plots

ladder_long_con<-subset(ladder_survey_long, Treatment == "Control")


ladder_control <- ladder_long_con %>%
  group_by(Site, Trip, Quadrat, cover_type) %>%
  summarize(mean_cover = mean(percent_cover),
            mean_se = sd(percent_cover) / sqrt(n()))

ladder_control_graph <- ggplot(ladder_control) +
  aes(x = Trip, y = mean_cover, fill = cover_type) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_cover - mean_se, ymax = mean_cover + mean_se), 
                position = position_dodge(width = 0.7), width = 0.2) +
  scale_fill_manual(values = c("lightgray", "darkgray"),
                    labels = c("grass", "other plants")) +
  labs(
    x = "",
    y = "Percent cover",
    fill = "Cover type",
    title = "Control plots"
  ) +
  scale_x_discrete(
    limits = c("1", "2", "3"),
    labels = c("1" = "Aug. 22", "2" = "Nov. 22", "3" = "Mar. 23")
  ) +
  theme_minimal() +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines"),
    text = element_text(size = 12),
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 12),
    axis.text.x = element_text(size = 12),
    plot.title = element_text(size = 12),
    legend.title = element_text(size = 12),
    legend.text = element_text(size = 10),
    strip.text = element_text(size = 10),  
    legend.position = "bottom"
  ) +
  facet_grid(vars(Quadrat), vars(Site))

print(ladder_control_graph)
  


combined_ladder_graphs <- grid.arrange(ladder_sargasso_graph, ladder_control_graph, ncol = 1)
  

#make graphs for percent cov

```

##full perimeter percent cover
```{r}
#import dataset
perimetersurvey_full<-read.csv("perimeter_survey.csv", header = TRUE)

perimeter_prc_long<-perimetersurvey_full %>%
  gather(key = "cover_type", value = "prc_cover", c(7:58))

perimeter_prc_long$Trip<-as.factor(perimeter_prc_long$Trip) 
perimeter_prc_long$Block<-as.factor(perimeter_prc_long$Block) 

#select only relevant columns
perimeter_prc_long <- perimeter_prc_long %>% select( c(1:5,15,16))
#remove zeros so the data is not so cluttered
# Remove rows where prc_cover is zero
perimeter_prc_long <- subset(perimeter_prc_long, prc_cover != 0)



perimeter_prc_long %>%
  filter(Site %in% "Jungle") %>%
  ggplot() +
  aes(x = Trip, fill = cover_type, weight = prc_cover) +
  geom_bar(position = "fill") +
  theme_minimal() +
  facet_grid(vars(Block), vars(Treatment)) +
  labs(y = "Proportion")


perimeter_prc_long %>%
 filter(Site %in% "Dunes") %>%
 ggplot() +
 aes(x = Trip, fill = cover_type, weight = prc_cover) +
 geom_bar(position = "fill") +
 theme_minimal() +
 facet_grid(vars(Block), vars(Treatment)) +
  labs(y = "Proportion")

```

##full interior percent cover
```{r}
interiorsurvey_full<-read.csv("interior_survey.csv", header = TRUE)

#make data long with species types all stacked
interior_prc_long<-interiorsurvey_full %>%
  gather(key = "cover_type", value = "prc_cover", c(6:55))

interior_prc_long$Trip<-as.factor(interior_prc_long$Trip) 
interior_prc_long$Block<-as.factor(interior_prc_long$Block) 
#remove zeros so the data is not so cluttered
# Remove rows where prc_cover is zero
interior_prc_long <- subset(interior_prc_long, prc_cover != 0)
#select only relevant columns
interior_prc_long <- interior_prc_long %>% select( c(1:5,14,15))
  

interior_prc_long %>%
 filter(Site %in% "Dunes") %>%
 ggplot() +
  aes(x = Trip, fill = cover_type, weight = prc_cover) +
  geom_bar(position = "fill") +
  scale_fill_hue(direction = 1) +
  theme_minimal() +
  facet_grid(vars(Block), vars(Treatment))+
  labs(y = "Proportion")

interior_prc_long %>%
 filter(Site %in% "Jungle") %>%
 ggplot() +
  aes(x = Trip, fill = cover_type, weight = prc_cover) +
  geom_bar(position = "fill") +
  scale_fill_hue(direction = 1) +
  theme_minimal() +
  facet_grid(vars(Block), vars(Treatment)) +
   labs(y = "Proportion")

```



##practice
```{r}


# Create the plot with jittered dots and error bars
pitfall_count <- ggplot(pitfalls_data) +
  aes(x = Trip, y = mean_count, shape = Taxa) +  # shape by Site
  geom_jitter(position = position_dodge(width = 0.5), size = 2, alpha = 0.7) +   
  geom_errorbar(aes(ymin = mean_count - std_error, ymax = mean_count + std_error),
                position = position_dodge(width = 0.5), width = 0.2) +  
  theme_minimal() +
  scale_x_discrete(
    limits = c("1", "2", "3"),
    labels = c("1" = "Aug. 22", "2" = "Nov. 22", "3" = "Mar. 23")) +
theme_minimal() +
theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines"),
    text = element_text(size = 14),
    axis.title = element_text(size = 16),
    axis.text = element_text(size = 14),
    axis.text.x = element_text(size = 14),
    plot.title = element_text(size = 12),
    legend.title = element_text(size = 16),
    legend.text = element_text(size = 14),
    strip.text = element_blank(),
      legend.position = "bottom") +
  xlab("") +
  ylab("Crawling arthropod abundance") +
  
  facet_grid(vars(Treatment), vars(Site), scales = "fixed", space = "fixed", labeller = labeller(Treatment = c(Control = "control", Sargassum = "sargasso"))) +
    guides(shape = FALSE)  


pitfall_count


# combine

combined_pitfall_graphs <- grid.arrange(
  pitfall_count,
  pitfall_eff_plot,
  ncol = 1,
  heights = c(3, 2))

# Print or display the combined plot
print(combined_pitfall_graphs)



# Create the plot with jittered dots and error bars
stickies_prc_cover <-ggplot(stickies_data) +
  aes(x = Trip, y = mean_count, shape = Taxa) +  
  geom_jitter(position = position_dodge(width = 0.5), size = 2, alpha = 0.7) +   
  geom_errorbar(aes(ymin = mean_count - std_error, ymax = mean_count + std_error),
                position = position_dodge(width = 0.5), width = 0.2) +   
  theme_minimal() +
  scale_x_discrete(
    limits = c("1", "2", "3"),
    labels = c("1" = "Aug. 22", "2" = "Nov. 22", "3" = "Mar. 23")) +
theme_minimal() +
theme(
    panel.border = element_rect(color = "black", fill = NA, size = 1),
    panel.spacing = unit(0.2, "lines"),
    text = element_text(size = 14),
    axis.title = element_text(size = 16),
    axis.text = element_text(size = 14),
    axis.text.x = element_text(size = 14),
    plot.title = element_text(size = 12),
    legend.title = element_text(size = 16),
    legend.text = element_text(size = 14),
    strip.text = element_blank()
  ) +
  xlab("") +
  ylab("Flying arthropod abundance") +
  facet_grid(vars(Treatment), vars(Site), scales = "free", space = "fixed", labeller = labeller(Treatment = c(Control = "control", Sargassum = "sargasso"))) +
    guides(shape = FALSE)   
stickies_prc_cover
































sargman<-read.csv("nmec.csv",header=T)

# Assuming your_data is your original data frame
sargman2 <- sargman %>%
  pivot_longer(cols = c(top_layer, bottom_layer), names_to = "layer", values_to = "species")










# Assuming your_data is your data frame
wide_data <- reshaped_data %>%
  pivot_wider(names_from = species,
              values_from = species,
              values_fn = length,
              values_fill = 0,
              names_prefix = "")

# Print the resulting wide_data
view(wide_data)


long_data <- gather(wide_data, key = "species", value = "count", 14:81, -c(1:13))


# Group the data by quadrat_code and survey_date, then calculate the sum of other columns
collapsed_df <- long_data %>%
  group_by(quadrat_code, survey_date) %>%
  summarize(total = sum(count),   # Replace 'column1' with the column you want to sum
            # Add more columns you want to sum here
            )

# Replace 'column1', etc. with the actual column names you want to sum.


# Group the data by 'quadrat_code' and 'survey_date', and summarize the data
summary_df <- wide_data %>%
  group_by(quadrat_code, survey_date) %>%
  summarize(total = sum(column_to_sum),  # Replace 'column_to_sum' with the column you want to summarize
            mean_value = mean(another_column))  # Replace 'another_column' with another column you want to summarize

# Replace 'column_to_sum' and 'another_column' with the actual columns you want to summarize.



# Assuming your data frame is named 'df'
library(dplyr)

# Add a new column 'total' that contains the sum of columns 3 through 30
wide_data2 <- wide_data %>%
  mutate(total = rowSums(across(14:81)))

# This calculates the sum of columns 3 through 30 for each row.

view(wide_data2)

```

